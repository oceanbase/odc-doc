# ODC V4.2.3

<main id="notice" type='notice'>
  <h4>注意</h4>
  <ul>
  <li>从 ODC V4.2.0 之前的版本升级到 ODC V4.2.3 版本前，请务必阅读本篇文档中的<strong>升级注意事项</strong>。</li>
  <li>使用 ODC V4.2.3 版本前，请关注 <a href="../../200.odc-overview/500.product-limits.md">ODC V4.2.3 产品能力限制</a>。</li>
  </ul>
</main>

## 升级注意事项

- 数据源

   - ODC V4.2.0 及之后的版本，连接配置概念调整为数据源。

   - ODC V4.2.2 版本暂不支持新建 ODP 数据源，后续版本恢复。

   - ODC V4.2.0 及之后的版本，个人连接迁移到个人空间，以数据源的形式存在。

   - ODC V4.2.0 及之后的版本，公共连接迁移到团队空间，以数据源的形式存在。

   - ODC V4.2.0 及之后的版本，原公共连接中的只读、读写账号，升级后仅保留读写账号。

- 用户权限

   - private_connection/apply_connection 角色已在 ODC V4.2.0 及之后的版本中下线，升级到 ODC V4.2.x 版本的用户引用的 private_connection/apply_connection 角色对应的权限不再生效。

   - 资源组已在 ODC V4.2.0 及之后的版本中下线。

   - 连接访问权限已在 ODC V4.2.0 及之后的版本中下线，ODC V4.2.x 中通过项目管控实现对数据库的访问控制。

- 系统设置

   - 已 ODC V4.2.0 及之后的版本中下线。

- 工单模块

   - ODC V4.2.0 之前的版本发起的工单仅支持在 **我发起的** 的分类下查看用户自己发起的工单。

- 分区计划

   - 该功能在 ODC V4.2.0 版本中升级，升级到 ODC V4.2.x 版本后，在 ODC V4.2.0 之前版本创建的历史分区计划任务将停止运行。

- SQL 计划

   - 该功能在 ODC V4.2.0 版本中升级，升级到 ODC V4.2.x 版本后，在 ODC V4.2.0 之前版本创建的历史 SQL 计划任务将停止运行。

- 任务流程

   - 该功能模块在 ODC V4.2.0 及之后的版本中下线，ODC V4.2.x 中已上线风险等级模块实现对应效果。

- 数据脱敏

   - 该功能模块在 ODC V4.2.0 版本中升级，升级到 ODC V4.2.x 版本后，在 ODC V4.2.0 之前版本创建的数据脱敏配置不再生效。

- 堡垒机集成

   - 该功能在 ODC V4.2.2 中支持账号集成和数据源配置自动填写，暂不支持 SQL 审核集成，后续版本恢复。

- 历史会话

   - 历史会话在 ODC V4.2.0 及之后的版本中下线，ODC V4.2.x 中默认会保存 SQL 窗口的使用状态。

## ODC V4.2.3-BP

本次 2 月发版的 OceanBase 开发者中心（OceanBase Developer Center，ODC）V4.2.3-PB 版本旨在修复某些缺陷。具体请参见本篇文档中的 **问题修复**。

### 版本信息

* **当前版本：** V4.2.3-BP

* **前置版本：** V4.2.3

* **发版时间：** 2024 年 2 月 1 日

* **支持的升级路径：** 对于 ODC V2.0.0 及之后的版本，均可直接升级至本版本。

### 问题修复

* 修复 Ubuntu 系统无法打开命令行窗口的缺陷。

* 修复使用 OceanBase Oracle V2.2.30 版本执行 SQL 报错的缺陷。

* 修复 SQL 检测规范和 SQL 窗口规范中数据源类型筛选无效的缺陷。

* 修复任务创建者和审批人不是当前用户时，查看任务审批节点报错的缺陷。

* 修复导出包体和同义词时未展示对象类型的缺陷。

* 修复 OceanBase Oracle 模式数据库名称为小写时数据库变更预检查失败的缺陷。

* 修复 SQL 窗口查询请求中，退出登录前端崩溃的缺陷。

* 修复设置手动提交时，SQL 语句执行失败导致回滚的缺陷。

* 修复结果集中存在多列时滑动后无法选中且随机点偶现前端崩溃的缺陷。

* 修复 DLM 更新限流周期任务失败的缺陷。

* 修复结果集筛选后查看列模式无内容的缺陷。

* 修复结果集中选中列未展示注释的缺陷。

* 修复结果集中插入数据报错的缺陷。

* 修复 SQL 窗口执行语句返回结果后切换数据库导致前端崩溃的缺陷。

* 修复 SQL 检查包含分隔符会报错的缺陷。

* 修复打开 SQL 检查中允许执行的 SQL 类型选项后，执行匿名块报错的缺陷。

## ODC V4.2.3

本次 12 月发版的 OceanBase 开发者中心（OceanBase Developer Center，ODC）V4.2.3 版本主要增强了以下四个方面的功能：

- **变更风险管控**：在本次更新中，ODC 继续提高变更风险管控模块的易用性。现在，普通用户可以主动申请加入项目，同时 ODC 也优化了 SQL 拦截的交互体验。

- **数据生命周期管理**：现在支持在产品页面上追溯日志，这显著提高了对异常执行记录的问题排查效率。对于定期执行的归档或清理任务，用户现在可以编辑其参数，这使得任务的操作对象、处理逻辑以及执行周期的调整变得更加迅速。

- **无锁结构变更**：针对不支持表重命名原子性操作的 OceanBase 版本，为了在表名切换过程中减少对业务的影响，本版本允许只锁定用户指定账号。同时用户可以选择手动切换表名，从而降低在业务高峰时的操作风险。另外，变更过程中的关键信息和业务状态都会记录在日志中，以便于监控和问题排查。

- **MySQL 数据源支持**：继上个版本新增了对原生 MySQL 数据源的支持之后，本版本进一步支持了导入导出功能。用户现在可以通过 ODC 导出 MySQL 数据源中的结构或数据，并能将导出的内容重新导入到 MySQL 数据源中。

### 版本信息

* **当前版本：** V4.2.3

* **前置版本：** V4.2.2

* **发版时间：** 2023 年 12 月 25 日

* **支持的升级路径：** 对于 ODC V2.0.0 及之后的版本，均可直接升级至本版本。

### 功能变更

* 数据源

  - 支持创建 OceanBase Sharding MySQL 数据源并对其进行开发操作。

  - 支持将数据源和项目绑定，数据源中数据库的变动自动同步到绑定的项目。

  - 支持复制（克隆）数据源。

  - 支持展示团队空间资源树中数据源的可用状态。

* SQL 开发

  - 数据库对象

     - OceanBase MySQL 和 MySQL 数据源增加对 Gis 字段类型的支持。

     - 白屏新建或删除索引时给出高风险操作提示。

   - SQL 窗口

     - 为 SQL 窗口的运行键增加快捷键（Windows 平台 Ctrl+Enter，macOS 平台 Cmd+Enter）。

     - 执行计划展示由原来的默认收起状态调整为默认展开状态。

     - 代码片段可保存片段大小上限调整为 64KB。

   - 结果集

     - 对于查询结果集支持通过单击列头全选列进行复制。

     - 结果集更新逻辑优化，为了保障更新安全不支持无法确定更新记录唯一性（不包含 ROWID、主键或唯一约束）的更新。

   - 全链路诊断

     - 优化全链路诊断的展示形式，并将执行计划和全链路诊断信息通过不同的入口分开展示。

     - 对于不支持全链路诊断的 OceanBase 版本，全链路诊断信息入口置灰并给出提示。

     - 支持将全链路诊断内容导出 Jaeger 兼容的 JSON 文件。

     - 支持将全链路诊断内容展示为列表视图。

   - 导入导出

     - 支持对 MySQL 数据源进行导入导出操作，同时若导出内容涉及敏感列使用全部遮掩算法进行脱敏。

     - OceanBase 数据源的导入导出任务配置页面中不再提供 SYS 账户配置。

* 变更风险管控

  - 扩充内置项目角色，增加了安全管理员和参与者角色，安全管理员可管理项目的敏感列和参与工单审批，参与者可参与工单审批。

  - 支持用户主动申请加入项目。

  - 支持审批人查看自己审批过的工单，支持项目管理员查看项目内的所有工单。

  - 禁止删除有项目 DBA 角色或项目 OWNER 角色的用户。

  - 安全规范中增加一条 SQL 检查规则（自增主键的字段类型限制，默认值为 BigInt）。

  - 优化不符合规范的 SQL 语句的拦截交互，方便快速定位 SQL 中的具体问题。

  - 支持工单详情通过 URL 链接分享。

* 数据生命周期

  - 优化了数据清理、数据归档任务发起的交互（调整变量设置位置）。

  - 数据清理、归档任务支持查看执行记录的日志。

  - 对于周期执行的数据清理、归档任务支持对其任务参数进行编辑。

  - 优化了 MySQL 5.6 及 OceanBase 的数据清理表现。

  - 支持分区计划任务配置定时调度策略。

* 无锁结构变更

  - 支持将任务执行过程中的关键步骤及关键状态（如表名切换前后的会话状态）输出到任务日志。

  - 对于表名切换时不支持锁表的数据库版本，支持锁定指定账号并关闭指定账号的会话。

  - 支持用户手动触发表名切换。

* 其它模块变更

  - 提供参数配置项来解除登录失败限制。

  - 增加了自动重连机制，避免长时间不使用场景下会话销毁导致的报错及易用性问题。

  - 堡垒机集成支持 SQL 检查。

### 问题修复

* 数据源

  * 用户离开项目且不属于任何项目和角色时依然可以创建数据源。

  * OceanBase MySQL 以及原生 MySQL 模式下数据库会话中"执行时间"栏目为 0。

  * OceanBase Oracle 模式下通过会话变量管理功能进行时间输出格式的修改在 SQL 执行窗口不生效。

  * OceanBase Oracle 模式下无法连接小写的 Schema。

  * 无法连接 percona 分支构建的 MySQL 数据源。

* SQL 执行

  * SQL 执行过程中抛出错误没有国际化。

  * 无法在团队空间下执行带有 dblink 的 SQL。

  * 安全规则允许的前提下，无法在团队空间中执行 desc 语句。

  * OceanBase Oracle 模式下执行 SELECT ... ORDER BY 1 样式的语句时 ORDER BY 会失效。

  * 禁用 **SQL 窗口允许执行的 SQL 类型** 规则不生效。

* 数据库对象管理

  * OceanBase MySQL 模式下左侧对象树上展示的表的分区等对象的名字带有反引号包围符。

* 结果集导出

  * 任务没有日志打印。

  *  以 excel 格式导出后没有数据。

* PL 对象

  * 交互式创建函数过程中，无法通过下拉菜单定义 sys_refcursor 类型的返回值。

  * OceanBase MySQL 模式下 PL 参数值没有对单引号转义。

* DLM

  * 数据库连接池过小导致任务执行失败。

* 分区计划

  * 在 OceanBase 1.4.79 版本的 MySQL 模式下创建任务失败。

  * 不设置分区策略的表依然会执行分区计划变更。

* SQL 开发规范

  * 无法识别 `alter table xxx drop index` 语句为 DROP INDEX 语句。

* 外部审批集成

  * 无法识别索引集合中的数据的表达式

  * 外部系统返回的 xml 形式的数据在反序列化时会丢失原始 xml 的根 tag。

* 数据脱敏

  * 当扫描到重复列时会导致敏感列添加失败。

* 项目

  * 用户被赋予"个人空间"权限后必须重新登陆才能生效。

  * 同步大量数据库或 Schema 到项目时发生事务超时。

  * 无法以项目维度过滤工单。

  * 项目 OWNER 可以将项目中所有 DBA 角色的用户全部移除。

* 堡垒机集成

  * 不活跃连接未被清理。

* 回收站

  * 无法删除回收站中的特定对象。

* 模拟数据

  * 任务占用过多内存。

  * 不支持 ZHSGB232 编码。

  * OceanBase MySQL 以及原生 MySQL 模式下无法对宽度在 8 以下的 bit 类型生成任务。

  * 无法跳过自增的主键列。

  * OceanBase MySQL 以及原生 MySQL 模式下 bit 类型宽度显示错误。

* 数据库变更任务

  * 上传大文件场景下出现内存溢出错误。

* 全链路诊断

  * 将驱动加入全链路诊断后导致的内存溢出问题。

* 影子表同步

  * 工单被同意或拒绝后审批者无法查看任务详情。

* OBClient 集成

  * 重复创建同名操作系统用户导致报错。

* 工单

  * 创建工单耗时过久。

  * 一个项目的 **待审批** 工单列表中存在另一个项目的 **待审批** 工单。

* 操作记录

  * 操作记录中 **数据源** 栏目为空。

  * SQL 执行事件未被记录。

  * 打开 SQL 窗口事件未被记录。

### 已知问题

* 客户端版 ODC 不支持安装在中文目录名中。

* 导出包含虚拟列的表时，导出的数据文件和内容显示异常。

* Web 版 ODC 中，结构或数据的导入量上限为 2GB，超限文件无法上传。

* Web 版 ODC 中，结构或数据的导出量上限为 2GB，超限会导致最终导出数据不完整。

* 导出任务详情中，导出对象的数据总记录数依赖 OceanBase 数据库视图，并非精准值。

* 需设置 `ob_enable_trace_log` 参数为 `on`，否则只显示首次执行的 SQL 的执行计划。

## 相关文档

- [开源版 ODC](https://github.com/oceanbase/odc)

- [企业版 ODC](https://www.oceanbase.com/product/odc)