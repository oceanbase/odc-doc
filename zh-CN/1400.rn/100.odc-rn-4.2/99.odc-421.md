# ODC V4.2.1

本次 10 月发版的 OceanBase 开发者中心（OceanBase Developer Center，ODC）V4.2.1 版本旨在修复 ODC 4.2.0 缺陷进行了并对用户体验进行了优化。

## 版本信息 

* **当前版本：** V4.2.1

* **前置版本：** V4.2.0

* **发版时间：** 2023 年 10 月 9 日

* **支持的升级路径：** 对于 ODC V2.0.0 及之后版本，均可直接升级至本版本。

## 支持的 OceanBase 数据库版本

OceanBase 开发者中心 V4.2.0 版本支持下述版本的 OceanBase 数据库。

* ODC 通用功能支持 OceanBase 数据库版本

  * OceanBase V1.4.x（主流版 V1.4.7）
  
  * OceanBase V2.0.x
  
  * OceanBase V2.1.x
  
  * OceanBase V2.2.x（主流版 V2.2.7）
  
  * OceanBase V3.1.x（主流版 V3.1.2）
  
  * OceanBase V3.2.x（主流版 V3.2.4）

  * OceanBase V4.0.0

  * OceanBase V4.1.0

  * OceanBase V4.2.0

  * OceanBase V4.2.1
  
  * OceanBase 社区版

* ODC PL 功能支持 OceanBase 数据库版本

  * PL 对象（函数/存储过程/程序包）编译、PL 对象（函数/存储过程）调试和匿名块调试：支持 V2.2.7、V3.0.x 及之后版本，推荐 OceanBase V3.2.3 BP4 及之后版本体验更友好的调试能力。
  
  * PL 对象（函数/存储过程/程序包）运行和匿名块运行：支持 V2.0.x 及之后版本。

## 功能限制

* 数据归档

  * 数据源必须配置集群实例（集群名称）。

  * 数据源必须通过 proxy 连接（不支持直连 OceanBase）。

  * 非阿里云公有云环境必须配置 sys 租户账号。

  * OceanBase V4.1.0 版本不支持数据归档。

  * 只支持 OceanBase MySQL 模式数据归档。

  * 只支持主键 PRIMARY KEY 的表进行归档。
  
  * BIT、enum、set 数据类型不支持数据归档。
  
  * 条件中包含 limit 类型不支持数据归档。
  
  * 拥有外键的表不支持数据归档。

* 自动生成回滚语句

  * 只支持对 UPDATE 和 DELETE 语句生成回滚。

  * OceanBase MySQL 模式下，无主键或者唯一键的表进行 UPDATE/DELETE 时不支持生成对应回滚 SQL。

  * 不支持对包含大字段的变更表生成回滚 SQL。
  
  * 生成备份回滚方案支持的数据库变更任务总的变更行数为 100W，超过此变更行数生成备份回滚方案失败。
  
  * 生成的备份回滚方案文件大小不能超过 256MB，原因是数据库变更任务支持上传的最大 SQL 脚本大小为 256M。
  
  * OceanBase oracle 模式下，暂不支持 UPDATE 场景中 UPDATE SET 和 WHERE 的字段相同的情况下自动生成回滚语句。

* 动态脱敏

  * Groovy 只允许用户使用 Java 中的 Objects 类 和 Stirng 类。
  
  * 不支持 Groovy 闭包、自带的闭包函数等。

* SSO 集成

  * 只支持授权码模式。
  
  * 退出登录只清除 ODC 应用的登录态。不会清理 SSO 系统的登录态。
  
  * 映射名称必须为字符串 String 类型。

## 升级注意事项

* 数据源

  * 连接配置概念调整为数据源。

  * ODC V4.2.1 暂不支持新建 ODP 数据源，后续版本恢复。

  * 个人连接迁移到个人空间，以数据源的形式存在。

  * 公共连接迁移到团队空间，以数据源的形式存在。

  * 原公共连接中的只读、读写账号，升级后仅保留读写账号。

* 用户权限

  * private_connection/apply_connection 角色已在 ODC V4.2.0 下线，升级到 ODC V4.2.x 版本的用户引用的 private_connection/apply_connection 角色对应的权限不再生效。

  * 资源组已在 ODC V4.2.0 中下线。

  * 连接访问权限已在 ODC V4.2.0 中下线，ODC V4.2.x 中通过项目管控实现对数据库的访问控制。

* 系统设置

  * 已在 ODC V4.2.0 版本中下线。

* 工单模块

  * ODC V4.2.0 之前版本发起的工单仅支持在 **我发起的** 的分类下查看用户自己发起的工单。

* 分区计划

  * 该功能在 ODC V4.2.0 版本中升级，升级到 ODC V4.2.x 版本后，在 ODC V4.2.0 之前版本创建的历史分区计划任务将停止运行。

* SQL 计划

  * 该功能在 ODC V4.2.0 版本中升级，升级到 ODC V4.2.x 版本后，在 ODC V4.2.0 之前版本创建的历史 SQL 计划任务将停止运行。

* 任务流程

  * 该功能模块在 ODC V4.2.0 中下线，ODC V4.2.x 中已上线风险等级模块实现对应效果。

* 数据脱敏

  * 该功能模块在 ODC V4.2.0 版本中升级，升级到 ODC V4.2.x 版本后，在 ODC V4.2.0 之前版本创建的数据脱敏配置不再生效。

* 堡垒机集成

  * 该功能在 ODC V4.2.1 中暂不可用，后续版本恢复。

* 历史会话

  * 历史会话在 ODC V4.2.0 版本中下线，ODC V4.2.x 中默认会保存 SQL 窗口的使用状态。

## 问题修复

* SQL 执行

  * 使用 OceanBase V4.0.0 之前的版本执行 SQL 语句时，无法打印 DBMS 输出。

  * 编辑结果集时 DML 语句生成速度缓慢。

* 导入导出

  * 任务执行过程中，在任务详情中未显示导入/导出对象。

* PL 调试

  * OceanBase 多节点部署时 PL 调试偶现无法连接到数据库。

  * OceanBase Oracle 模式小写 schema 下调试匿名块时，获取数据库连接错误。

* 数据源管理

  * 回收站模块生成的针对索引的 FLASHBACK 语句执行报错。

  * 会话管理界面无法显示会话正在执行的 SQL。

  * 批量导入连接时，模版文件中存在空行或空列时引发空指针异常。

  * 使用旧版本的浏览器创建数据源时，无法下拉选择数据源类型。

  * 同步数据库时会同时显示其他租户下的数据库。

* 数据脱敏

  * OceanBase MySQL 模式下，配置为大小写敏感时，敏感列无法区分大小。

  * 导出结果集时，数据脱敏未生效。

* 工单管理

  * 提交工单后，工单状态长期处于 **排队中** 不更新且工单不报错。

* 第三方集成

  * 审批流未包含外部审批节点时同样会尝试获取外部审批工单的 ID。

* SQL 检查规范

  * OceanBase Oracle 模式下，无法检测表或列的注释是否存在。

* 结果集

  * 过滤结果集时，列模式显示不正确。

* SQL 窗口

  * SQL 窗口搜索后会删除第一个匹配到的关键字。

* 安全加固

  * 解决第三方集成过程中可能发生的 SSRF 攻击。

## 已知问题

* 客户端版 ODC 不支持安装在中文目录名中。

* 导出包含虚拟列的表时，导出的数据文件和内容显示异常。

* Web 版 ODC 中，结构或数据的导入量上限为 2GB，超限文件无法上传。

* Web 版 ODC 中，结构或数据的导出量上限为 2GB，超限会导致最终导出数据不完整。

* 导出任务详情中，导出对象的数据总记录数依赖 OceanBase 数据库视图，并非精准值。

* 需设置 `ob_enable_trace_log` 参数为 `on`，否则只显示首次执行的 SQL 的执行计划。

## 相关文档

- [开源版 ODC](https://github.com/oceanbase/odc)

- [企业版 ODC](https://www.oceanbase.com/product/odc)