# ODC V4.3.0

<main id="notice" type='notice'>
  <h4>注意</h4>
  <ul>
  <li>从 ODC V4.2.0 之前的版本升级到 ODC V4.3.0 版本前，请务必阅读本篇文档中的<strong>升级注意事项</strong>。</li>
  <li>使用 ODC V4.3.0 版本前，请关注 <a href="../../200.odc-overview/500.product-limits.md">ODC V4.3.0 产品能力限制</a>。</li>
  </ul>
</main>

## 升级注意事项

- 数据源

   - ODC V4.2.0 及之后的版本，连接配置概念调整为数据源。

   - ODC V4.2.0 及之后的版本，个人连接迁移到个人空间，以数据源的形式存在。

   - ODC V4.2.0 及之后的版本，公共连接迁移到团队空间，以数据源的形式存在。

   - ODC V4.2.0 及之后的版本，原公共连接中的只读、读写账号，升级后仅保留读写账号。

- 用户权限

   - private_connection/apply_connection 角色已在 ODC V4.2.0 及之后的版本中下线，升级到 ODC V4.2.x 版本的用户引用的 private_connection/apply_connection 角色对应的权限不再生效。

   - 资源组已在 ODC V4.2.0 及之后的版本中下线。

   - 连接访问权限已在 ODC V4.2.0 及之后的版本中下线，ODC V4.2.x 中通过项目管控实现对数据库的访问控制。

- 系统设置

   - 已 ODC V4.2.0 及之后的版本中下线。

- 工单模块

   - ODC V4.2.0 之前的版本发起的工单仅支持在 **我发起的** 的分类下查看用户自己发起的工单。

- 分区计划

   - 该功能在 ODC V4.2.0 版本中升级，升级到 ODC V4.2.x 版本后，在 ODC V4.2.0 之前版本创建的历史分区计划任务将停止运行。

- SQL 计划

   - 该功能在 ODC V4.2.0 版本中升级，升级到 ODC V4.2.x 版本后，在 ODC V4.2.0 之前版本创建的历史 SQL 计划任务将停止运行。

- 任务流程

   - 该功能模块在 ODC V4.2.0 及之后的版本中下线，ODC V4.2.x 中已上线风险等级模块实现对应效果。

- 数据脱敏

   - 该功能模块在 ODC V4.2.0 版本中升级，升级到 ODC V4.2.x 版本后，在 ODC V4.2.0 之前版本创建的数据脱敏配置不再生效。

- 堡垒机集成

   - 该功能在 ODC V4.2.2 中支持账号集成和数据源配置自动填写，暂不支持 SQL 审核集成，后续版本恢复。

- 历史会话

   - 历史会话在 ODC V4.2.0 及之后的版本中下线，ODC V4.2.x 中默认会保存 SQL 窗口的使用状态。

本次 6 月发版的 OceanBase 开发者中心（OceanBase Developer Center，ODC）V4.3.0 版本主要增强了以下三个方面的功能：

- 变更风险管控优化：

  - 提供多库变更能力，确保跨环境数据结构一致性，保障业务连续性；

  - 实施库权限精细化管理，引入库Owner角色并融入审批流程，加固安全防线；

  - 灵活性增强，用户可自选最佳时机手动执行工单任务，避峰保效。

- 数据生命周期管理强化：

  - 细化任务配置，支持按分区条件定制处理范围并允许指定任务执行时段，实现个性化数据管理；

  - 优化归档任务结构同步，确保源端目标端结构一致，提高成功率；

  - 清理任务融入数据校验，增强删除操作安全性；

  - 丰富执行记录详情，直观展示关键指标，提升透明度；

  - 全面支持各类字段，拓宽应用场景，满足多样化管理需求。

- 易用性提升：引入全局对象快速检索功能，简化用户查询流程，提升操作便捷性。

具体请参见本篇文档中的 **问题修复**。

## 版本信息 

* **当前版本：** V4.3.0

* **前置版本：** V4.2.4-BP

* **发版时间：** 2024 年 6 月 11 日

* **支持的升级路径：** 对于 ODC V2.0.0 及之后的版本，均可直接升级至本版本。

## 功能变更

* 变更风险管控

  - 新增多库变更任务，可将同一变更应用在多个数据库。同时在任务发起时支持配置灵活的变更流水线，可自由定义变更涉及库的分批、并行执行策略。此外变更流水线可保存为模板，方便后续复用。

  - 新增数据库管理员，项目管理员可以为项目内的库配置库管理员，库管理员可以在工单审批节点中引用，库管理员信息也会包含在 WebHook 事件中用于外部审批集成。

  - 发起任务时支持配置为手动执行，任务发起后，用户可以根据业务负载情况，选择最适宜的时间点执行任务。

* 数据归档/清理

  - 发起任务时，支持配置分区条件。可以按分区精确定义处理范围，减少无效分区扫描，提升任务效率。

  - 发起任务时，支持配置任务超时时间。执行耗时达到超时设定任务会暂停，等待下次执行窗口继续运行。

  - 发起归档任务时，支持配置增量结构同步。通过保障源端和目标端结构的一致性，提升归档任务的成功率（注意：将原生 MySQL 数据归档到 OceanBase MySQL 时，暂不支持增量结构同步）。

  - 发起清理任务时，支持配置数据校验。通过集成数据校验机制，以提升数据清理的可靠性。

  - 丰富执行记录详情，提供了常用的任务运行指标，包括扫描行数、实际处理行数、任务实际条件等等。

  - 数据归档/清理任务支持更多的字段类型。OceanBase MySQL 模式支持 BIT、ENUM、SET、XML、GEOMETRY 字段类型。OceanBase Oracle 模式新支持了 RAW、BLOB 、CLOB、BFILE、ROWID、UROWID、timestamp with time zone、timestamp with local time zone、interval year to month、interval day to second 字段类型。

- 全局对象检索

  - 新增全局对象检索功能，支持在项目范围内全局检索，已覆盖库、表、列、视图、函数、存储过程、程序包、触发器等对象。

  - 支持快捷键 Ctrl+J（Windows）/Command+J（MacOS） 快速唤起全局对象检索。

- OceanBase 适配

  - 支持 OceanBase 列存，包括表的存储模式和索引的存储模式。

  - 支持 OceanBase Oracle 模式 GIS 数据类型。

  - 全功能适配 OceanBase V4.2.3、OceanBase V4.3.0。

- 易用性改进

  - 数据源配置中的 JDBC 参数和初始化脚本会应用于导入导出任务，给导入导出任务提供更多灵活性。

  - 归档项目时，将检查定时任务是否全部关闭，若全部关闭方可执行归档操作。

## 问题修复

* 修复连接 OceanBase 备集群数据库时，查询表结构失败的缺陷。

* 修复重置连接时并发异常的缺陷。

* 修复存储过程和函数列表未按照名称排序的缺陷。

* 修复 OceanBase Oracle 模式下，批量编译 PL 语句失败的缺陷。

* 修复 SQL 窗口中超过 2000 个数据库时，无法切换数据库的缺陷。

* 修复设置报错不继续执行后，在 SQL 窗口中执行语句时该设置未生效的缺陷。

* 修复使用 OBClient 关闭连接后 SQL 窗口执行报错的缺陷。

* 修复 Oracle 数据源无法在 SQL 窗口中设置 NLS 参数的缺陷。

* 修复关闭数据归档/清理任务框架时，消息通知失效的缺陷。

* 修复编辑项目时报错项目已经存在的缺陷。

* 修复工单描述内容国际化失效的缺陷。

* 修复审批内容超长时审批失败 的缺陷。

* 修复执行结构比对任务时，目标表不存在出现结果异常的缺陷。

* 修复导入任务时，设置跳过表结构不生效的缺陷。

* 修复 OceanBase 租户配置 `lower_case_table_names=2` 时，报错表对象不存在的缺陷。

* 修复查询表对象信息时，分区表的唯一索引不可见的缺陷。

* 修复 swagger-ui.html 访问失败的缺陷。

## 已知问题

* 客户端版 ODC 不支持安装在中文目录名中。

* 导出包含虚拟列的表时，导出的数据文件和内容显示异常。

* Web 版 ODC 中，结构或数据的导入量上限为 2GB，超限文件无法上传。

* Web 版 ODC 中，结构或数据的导出量上限为 2GB，超限会导致最终导出数据不完整。

* 导出任务详情中，导出对象的数据总记录数依赖 OceanBase 数据库视图，并非精准值。

* 需设置 `ob_enable_trace_log` 参数为 `on`，否则只显示首次执行的 SQL 的执行计划。

## 鸣谢

特此致谢社区伙伴对本版本的贡献：

感谢书声科技团队 @isadba 增加了 Doris 数据源支持。

## 相关文档

- [开源版 ODC](https://github.com/oceanbase/odc)

- [企业版 ODC](https://www.oceanbase.com/product/odc)