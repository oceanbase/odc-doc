# ODC V4.3.1

<main id="notice" type='notice'>
  <h4>注意</h4>
  <ul>
  <li>从 ODC V4.2.0 之前的版本升级到 ODC V4.3.1-BP 版本前，请务必阅读本篇文档中的<strong>升级注意事项</strong>。</li>
  <li>使用 ODC V4.3.1-BP 版本前，请关注 <a href="../../200.odc-overview/500.product-limits.md">ODC V4.3.1-BP 产品能力限制</a>。</li>
  </ul>
</main>

## 升级注意事项

- 数据源

   - ODC V4.2.0 及之后的版本，连接配置概念调整为数据源。

   - ODC V4.2.0 及之后的版本，个人连接迁移到个人空间，以数据源的形式存在。

   - ODC V4.2.0 及之后的版本，公共连接迁移到团队空间，以数据源的形式存在。

   - ODC V4.2.0 及之后的版本，原公共连接中的只读、读写账号，升级后仅保留读写账号。

- 用户权限

   - private_connection/apply_connection 角色已在 ODC V4.2.0 及之后的版本中下线，升级到 ODC V4.2.x 版本的用户引用的 private_connection/apply_connection 角色对应的权限不再生效。

   - 资源组已在 ODC V4.2.0 及之后的版本中下线。

   - 连接访问权限已在 ODC V4.2.0 及之后的版本中下线，ODC V4.2.x 中通过项目管控实现对数据库的访问控制。

- 系统设置

   - 已 ODC V4.2.0 及之后的版本中下线。

- 工单模块

   - ODC V4.2.0 之前的版本发起的工单仅支持在 **我发起的** 的分类下查看用户自己发起的工单。

- 分区计划

   - 该功能在 ODC V4.2.0 版本中升级，升级到 ODC V4.2.x 版本后，在 ODC V4.2.0 之前版本创建的历史分区计划任务将停止运行。

- SQL 计划

   - 该功能在 ODC V4.2.0 版本中升级，升级到 ODC V4.2.x 版本后，在 ODC V4.2.0 之前版本创建的历史 SQL 计划任务将停止运行。

- 任务流程

   - 该功能模块在 ODC V4.2.0 及之后的版本中下线，ODC V4.2.x 中已上线风险等级模块实现对应效果。

- 数据脱敏

   - 该功能模块在 ODC V4.2.0 版本中升级，升级到 ODC V4.2.x 版本后，在 ODC V4.2.0 之前版本创建的数据脱敏配置不再生效。

- 堡垒机集成

   - 该功能在 ODC V4.2.2 中支持账号集成和数据源配置自动填写，暂不支持 SQL 审核集成，后续版本恢复。

- 历史会话

   - 历史会话在 ODC V4.2.0 及之后的版本中下线，ODC V4.2.x 中默认会保存 SQL 窗口的使用状态。

## ODC V4.3.0-BP

本次 8 月发版的 OceanBase 开发者中心（OceanBase Developer Center，ODC）V4.3.0-BP 版本旨在限制 MySQL 5.7 之前版本的同步表结构功能和修复某些缺陷。具体请参见本篇文档中的 **问题修复**。

### 版本信息

* **当前版本：** V4.3.1-BP

* **前置版本：** V4.3.1

* **发版时间：** 2024 年 8 月 13 日

* **支持的升级路径：** 对于 ODC V2.0.0 及之后的版本，均可直接升级至本版本。

### 功能变更

- 新增限制 MySQL 5.7 之前版本的同步表结构功能。

### 问题修复

* 修复 Windows 家庭版无法安装桌面版 ODC V4.3.1 的缺陷。

* 修复响应的内容类型为 text/plain 时，通知告警失败的缺陷。

* 修复调用 SQL 语句中的函数时，权限检查报错并拦截的缺陷。

* 修复仅拥有一张表的导出权限却可以整库导出的缺陷。

* 修复表的外键约束中 `ON DELETE` 规则展示不正确的缺陷。

* 修复普通用户发起的任务匹配到风险等级后，报错无权限查看任务详情的缺陷。

* 修复再次发起按照指定分区进行的数据归档任务时，未勾选指定分区的缺陷。

* 修复项目管理员查看工单详情时，详情页面中未展示 **编辑**、**终止** 等操作按钮的缺陷。

* 修复申请库权限时，**选择数据库** 选项一直处于加载中的缺陷。

* 修复申请表权限任务时，可选库中未置灰无效数据库的缺陷。

* 修复单击鼠标右键打开 SQL 开发窗口中的数据库对象结构树，打开的操作框太窄导致可操作项内容展示不全的缺陷。

## ODC V4.3.0

本次 7 月发版的 OceanBase 开发者中心（OceanBase Developer Center，ODC）V4.3.1 版本主要更新以下功能：

- 风险管理升级：引入了细粒度的表级权限控制，加强变更风险的监管。
- AP 功能扩展：加入了 SQL 计划实时执行分析能力，让 SQL 实时诊断变得直观且易于交互。
- 用户体验提升：新增了数据清理任务的编辑功能，并完善了数据源批量导入能力。同时也优化了非直连场景下的会话管理能力。

更多更新详情，请参见功能变更。

### 版本信息

* **当前版本：** V4.3.1

* **前置版本：** V4.3.0

* **发版时间：** 2024 年 7 月 31 日

* **支持的升级路径：** 对于 ODC V2.0.0 及之后的版本，均可直接升级至本版本。

### 功能变更

- 变更风险管控

  - 新增表级别权限管控，允许项目成员对不同表拥有不同操作权限，包括对表的查询、变更和导出操作，进一步加强管控协同能力。

- AP 开发

  新增实时执行剖析，可视化、交互式呈现 sql_plan_monitor。

  - 此功能需要 OceanBase V4.2.4 及之后且 OceanBase V4.3.0 之前版本或者 OceanBase V4.3.3 之后版本的数据源。

  - 支持对已完成的 SQL 执行进行分析，以及对执行中的 SQL 进行实时分析。

  - 提供执行计划的图形视图、表格视图和文本视图，直观展示算子之间的连接关系和步骤顺序。

  - 全局视图提供 Top5 耗时算子的排序和各项执行耗时阶段的全局汇总，快速定位性能瓶颈。

  - 算子节点包含算子的执行状态和详情信息，详细信息包括 CPU、内存、磁盘、吐行和节点属性。

  - 对于并行执行节点，支持按照 DB 耗时、IO 内存和吐行行数排序，快速定位数据倾斜，不仅支持分析单机执行计划也支持分析分布式执行计划。

  - 全新设计的一体化实时诊断页面，可以结合执行计划、全链路诊断，在一个页面完成执行剖析。

- 会话管理

  关闭会话/查询支持非直连 OBServer 场景。

  - 当连接为 OceanBase V4.2.3 和 OBProxy V4.2.5 及之后的版本时，使用 Client session 能力进行会话管理。

  - 在 OceanBase V4.2.1 Oracle 模式下，使用匿名块进行会话管理。

- 易用性改进

  - 数据清理任务支持编辑任务配置。

  - 数据源模块，批量导入数据源支持 MySQL、Oracle 和 Doris。

- OceanBase 适配

  - 全功能适配 OceanBase V4.2.4、OceanBase V4.3.1、OceanBase V4.3.2。

### 问题修复

* 数据生命周期管理

  - 修复未启用表结构同步时仍进行表结构对比的缺陷。

* 变更风险管控

  - 修复自动授权规则对 LoginSuccess 事件不生效的缺陷。

  - 修复申请库权限未匹配到风险等级的缺陷。

* 导入导出

  - 修复重新安装桌面版 ODC 后，导入任务可能会受到历史执行任务导入文件影响的缺陷。

* SQL 检查

  - 修复启用 SQL 窗口规范时，SQL 窗口的提交、回滚按钮可能会失效的缺陷。

* SQL 开发

  - 修复 PL 调试期间可能会报 NPE 异常的缺陷。

  - 修复 Oracle 模式下修改会话变量的 SQL 语句有误的缺陷。

  - 修复用户缺少 oceanbase.* 的 SELECT 权限时, SQL 执行失败的缺陷。

  - 修复 Oracle 模式下, 鼠标右键复制时间类型的数据到 SQL 的值为空的缺陷。

  - 修复程序包被误判断为 Schema，导致执行被拦截的缺陷。

  - 修复未识别出匿名块中的 Schema 时，可以使用匿名块访问无权限的 Schema 的缺陷。

* 模拟数据

  - 修复模拟数据任务无法终止的缺陷。

* 全局对象检索

  - 修复对象同步无法停止的缺陷。

* 工单

  - 修复检查结果文件不存在本机时，无法获取 SQL 检查结果的缺陷。

* 审计

  - 修复 `content_ip_address` 列值的实际长度超过了该列的长度限制的缺陷。

* 数据归档/数据清理

  - 修复数据归档失败，但数据清理任务仍在执行的缺陷。

* 分区计划

  - 修复 MySQL 模式下，不能识别分区键的数据类型的缺陷。

* 其他

  - 修复多节点部署使用进程模式调度任务时，所有任务会被调度到同一个节点的缺陷。

### 已知问题

* 客户端版 ODC 不支持安装在中文目录名中。

* 导出包含虚拟列的表时，导出的数据文件和内容显示异常。

* Web 版 ODC 中，结构或数据的导入量上限为 2GB，超限文件无法上传。

* Web 版 ODC 中，结构或数据的导出量上限为 2GB，超限会导致最终导出数据不完整。

* 导出任务详情中，导出对象的数据总记录数依赖 OceanBase 数据库视图，并非精准值。

* 需设置 `ob_enable_trace_log` 参数为 `on`，否则只显示首次执行的 SQL 的执行计划。

### 鸣谢

特此致谢社区伙伴对本版本的贡献：

感谢书声科技团队 @isadba 支持表级别权限管控。

## 相关文档

- [开源版 ODC](https://github.com/oceanbase/odc)

- [企业版 ODC](https://www.oceanbase.com/product/odc)