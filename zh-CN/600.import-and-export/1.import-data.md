# 导入结构和数据 

## 背景信息

ODC 支持批量导入数据库对象的结构和数据。

通过 ODC 导入任务可以分别导入数据库对象的结构和数据、仅导入数据或者仅导入结构。

- 导入结构和数据：同时导入数据库对象的定义语句及其数据。

- 仅导入数据：仅导入表/视图对象的数据。

- 仅导入结构：仅导入数据库对象的定义语句。

## 导入文件格式

ODC 导入工具支持导入 ZIP 压缩文件（批量导入和单表导入）、SQL 文件（批量导入）和 CSV 文件（单表导入）。

其中，ZIP 压缩文件是以 .zip 结尾的压缩包。创建导入任务时在面板中的 **导入内容** 项中选择了 **ZIP 压缩文件** 后还需在 **数据格式** 项中选择压缩包中的数据格式是 **CSV 格式** 或 **SQL 格式** 。

批量导入时支持导入 SQL 文件，SQL 文件是以 .sql 结尾包含可直接在数据库中执行的 `SELECT`、`INSERT`、`UPDATE`、`DELETE`、`CREATE` 和 `DROP` 语句的文件。

单表导入时支持导入 CSV 文件，CSV 文件是 .csv 或 .txt 结尾的支持自定义分割符的数据文件。

## 注意事项

- 通过 Web 版 ODC 导入文件时，最大支持导入 2GB 的数据（压缩后），超出部分无法上传。如需导入大量数据，请使用导数工具 [OBLOADER](https://www.oceanbase.com/docs/enterprise/oceanbase-dumper-loader-cn/V3.2.0/10000000000610772)。

- 任务的状态（成功、失败、取消等）不影响文件的生命周期；任务永久保留，任务相关的文件默认保留 14 天。

- OceanBase V2.2.30 版本之前仅支持字符编码 UTF8。

- 在 ODC V2.2.1 及之前的低版本中使用导入功能时必须通过 OBProxy 连接至目标实例，直连时 ODC 不支持导入功能。

- 使用 ODC V2.4.1 及之后的版本时，用户可以选择配置 sys 租户账号以提升导入速度。

## 新建导入任务

示例：将本地磁盘中表 employee 和 salary 的结构和数据批量导入到数据库 odc_test 中。

| 信息项 | 示例值 |
| ------ | ------ |
|所属数据源|mysql4.2.0 |
|数据库名称|odc_test|
|表名称|employee, salary|

1. 在 **工单** 页签中单击 **导入** > **新建导入**。

   ![2](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/420/8import%20and%20export/1import/2.png)

2. 在弹出的任务面板中，选择导入文件格式。

   ![3](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/420/8import%20and%20export/1import/3.png)

   <main id="notice" type='explain'>
     <h4>说明</h4>
     <ul>
     <li>ODC 目前支持批量导入 <strong>CSV 文件</strong>、 <strong>SQL 文件</strong> 和 <strong>ZIP 压缩文件</strong>。</li>
     <li><strong>导入文件格式</strong>为 CSV 文件时，支持跳过首行字段列头字段。</li>
     <li><strong>导入文件格式</strong>为 ZIP 压缩文件时，支持导入单表或者多表和跳过已存在的结构。</li>
     </ul>
   </main>

4. 上传导入文件。

   单击文件池进入文件资源管理器以选择需要导入的文件，或者直接将文件拖入文件池中以完成文件上传。上传的文件格式需要与所选择的导入文件格式相同，ZIP 压缩文件支持上传 .zip 结尾的文件、SQL 文件支持上传 .sql 文件以及 CSV 文件支持上传 .csv 文件。

5. 选择文件编码。

   ODC 目前支持 **ASCII** 、 **ISO-8859-1** 、 **GB2312** 、 **GBK** 、 **GB18030** 、 **Unicode（UTF-8）** 、 **Unicode（UTF-16）** 、 **Unicode（UTF-32）** 和 **BIG5** 等编码格式。

6. 进入导入设置面板。

   单击 **下一步：导入设置** 对导入的文件和 sys 租户账号进行设置。

7. 选择导入内容。

   ![4](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/420/8import%20and%20export/1import/4.png)

   <main id="notice" type='explain'>
     <h4>说明</h4>
     <ul>
     <li>当 <strong>导入格式** 为 ZIP 压缩文件时需指定该项。</li>
     <li>ODC 目前支持 <strong>仅导入数据</strong>、 <strong>仅导入结构</strong> 和 <strong>导入数据和结构</strong> 三种方式。其中导入结构指是否要导入对象的定义语句。</li>
     </ul>
   </main>  

8. 选择所属库。

   选择导入对象所在的数据库。该项下同时显示目标任务所在数据库的数据源名称。

9. 设置导入数据。

   当 **导入格式** 为 ZIP 压缩文件且 **导入内容** 不为仅导入结构时需设置导入数据。该项包含以下设置项：  

   * **导入前清空数据** ：勾选该项后，导入数据时将首先清空目标对象中原有的数据。

   * **批量提交数量** ：单击 **导入数据设置** 标签后的 **高级** 按钮，在弹出的列表中可指定该项。通过指定批量提交数量，可在导入文件中导入指定数量数据时添加一句 `COMMIT` 命令。

   * **不导入的数据类型** （可选）：可以通过该项指定导入数据时要跳过的数据类型。MySQL 和 Oracle 下可跳过的类型不同，支持多选。

10. 设置导入结构。

   当 **导入内容** 为仅导入数据时，该项不可被指定。在该项下选择当对象结构已存在时的操作。选择 **跳过** 操作则在导入时跳过导入文件中的结构定义语句直接导入数据，该项会保留对象中的原数据。选择 **替换** 操作时则执行导入文件中的结构定义语句以重新创建并替换原对象，该项会清空对象中的原数据。

11. 设置任务错误处理和执行方式。

    * ODC 提供 **停止任务** 和 **忽略错误继续任务** 两种错误处理方式。需要在 **任务错误处理** 标签下选择需要的处理方式。

    * 支持选择 **立即执行** / **定时执行** 。

12. 设置 sys 租户账号。

    a. 在该项下选择是否 **使用 sys 租户账号提升任务速度** ，勾选后输入 **账户** 和 **密码** 。

    b. 输入账户和密码信息后，单击密码框后的 **测试连接** 按钮测试账户信息是否正确。默认自动填入连接设置的账号，如连接失败，建议修改密码用于此次导入。

      <main id="notice" type='notice'>
      <h4>注意</h4>
      <ul>
      <li><strong>sys 租户账号和密码</strong> 为集群租户下用户的账号和密码 (账号请勿填入"@sys#集群")。例如：账号 odc，密码 *******。</li>
      <li>如未配置 <strong>sys</strong> 租户账号，会导致导入导出速度下降。</li>
      </ul>
      </main> 
      

13. 保留当前配置。

    指定所有信息后，勾选面板左下角的 **保留当前配置** 以保留当前部分数据文件和结构文件配置。

14. 生成导入任务。

    指定所有信息后，单击面板右下角的 **提交** 按钮以生成导入任务。

15. 查看导入任务。

    任务生成后会自动弹出 **任务中心** 面板，在任务中心可以查看任务信息。

    


查看导入任务 
---------------------------

### 任务列表

<main id="notice" type='explain'>
  <h4>说明</h4>
  <ul>
  <li>任务列表中会显示最近 48 小时内的任务。</li>
  <li>最大支持 3 个导入任务并行运行，后续任务在队列中等待运行。</li>
  </ul>
</main> 

导入任务生成后会自动弹出 **工单** 面板，在 **导入** 列表中可以查看任务审批状态、任务信息和任务日志。

![5](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/420/8import%20and%20export/1import/5.png)

**导入** 任务列表中包含如下信息：

|  **信息项**  |    **说明** |
|-------|-------------|
| 编号  | 导入任务编号。 |
| 类型  | 显示新建任务时指定的任务类型。  |
| 工单描述  | 显示发起任务时填写的描述内容。  |
|当前处理人|审批人。单击搜索图标![搜索](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5526247461/p416691.jpg)，可搜索和筛选处理人。|
| 创建人   | 创建导入任务的用户。 单击搜索图标![搜索](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5526247461/p416691.jpg)，可搜索和筛选创建人。     |
| 创建时间  | 显示该任务生成的具体日期和时间。    |
| 状态  | 显示任务的当前状态（不同状态下提供的管理操作不同）。|
| 操作    | 单击 **查看** 按钮进入任务详情页面以查看目标任务的 **任务详情** 和 **任务日志**。  |

### 任务信息 

1. 如上图所示，在 **导入** 任务列表中单击 **查看** 按钮。

2. 弹出目标任务的任务详情面板，单击 **任务信息** 标签查看任务基本信息、导入文件信息和导入对象信息。

   ![6](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/420/8import%20and%20export/1import/6.png)

   |  信息项   | 说明     |
   |----------|----------|
   | 任务基本信息 | 显示执行状态、**任务编号** 、 **所属数据库**、 **任务类型**、**风险等级**、**执行方式**、**创建人** 和 **创建时间** 等信息。   |
   | 导入文件信息 | 显示创建导入任务时选择的 **导入文件格式**、 **导入文件**、 **文件编码**、 **数据格式** 和 **任务错误处理** 等信息。 |
   | 导入对象信息 | 显示该任务中您选择的对象在导入数据时的完成情况，包括  **对象名称**、 **对象类型**、**实际处理数量** 和 **数据处理状态** 等信息。   |

## 任务流程

在目标任务的任务详情面板中，单击 **任务流程** 标签查看 **发起任务** 、 **审批** 和 **执行** 状态等信息。

![7](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/420/8import%20and%20export/1import/7.png)

### 任务日志 

![8](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/420/8import%20and%20export/1import/8.png)

在目标任务的任务详情面板，单击 **任务日志** 标签查看任务的全部日志和告警日志。


   | 信息项  | 说明  |
   |--------|---------|
   | 全部日志 | 全部日志显示任务的 **INFO** 、 **ERROR** 和 **WARN** 日志等全量信息。        |
   | 告警日志 | 告警日志单独显示任务的 **ERROR** 和 **WARN** 日志。当任务失败时，可通过告警日志查看错误信息。 |

   同时，工具栏提供了以下功能键：

   | 功能 |  说明      |
   |--------|----------|
   | 查找 | 单击该按钮查找日志信息。 |
   | 下载 | 单击该按钮下载日志信息。 |
   | 复制 | 单击该按钮复制日志信息。 |


## 相关文档

- [导出数据](2.export-data.md)