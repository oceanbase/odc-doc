# 分区管理

## 背景信息

- **Range 分区**：基于属于一个给定连续区间的列值，将多行分配给分区。范围必须是有序的、连续的和不重叠的。详情请参见 [设置分区规则](../500.sql-development/700.database-objects/100.web-odc-table-objects/200.web-odc-create-a-table.md)。

- **分区计划**：在 Range 分区表中插入数据时，如果插入的数据超出当前分区的区间上限值，将无法插入数据并且会返回错误。分区计划是专门针对 Range 分区的扩展功能，ODC 支持依据用户设置的分区策略对 Range 分区表进行自动管理，用户无需手动创建新分区，以方便维护 Range 分区表。

本文档旨在介绍如何在 ODC 上使用分区计划，包括对新建和删除的表分区进行自动管理。 

## 注意事项

- 仅支持 OceanBase MySQL 数据源。

- 仅支持Timestamp 字段类型的 Range 分区表及 Date 字段类型的 Range Columns 分区表。

## 新建分区计划

<main id="notice" type='notice'>
   <h4>注意</h4>
   <ul>
   <li>ODC V4.0.0 及之后版本的分区计划功能仅支持 Timestamp 字段类型的 Range 分区表及 Date 字段类型的 Range Columns 分区表。存在其它字段类型的 Range/Range Columns 分区表时，会跳过创建该类型的分区计划并记录警告日志。</li>
   <li>分区计划默认每小时的 00 分 00 秒执行。</li>
   </ul>
</main>

示例：在数据源 mysql410 下数据库 odc_test 中，每隔 3 个月预创建 2 个分区，创建的分区保留 12 个月。

| 信息项 | 示例值 |
| ------ | ------ |
|项目名称 | odc_4.2.0 |
|所属数据源|mysql410 |
|数据库名称|odc_test|

1. 在 SQL 开发窗口的 **工单** 页签中单击 **分区计划** > **新建分区计划**。

2. 在 **新建分区计划** 面板中指定以下信息。

   | **信息项** | **说明**   |
   |---------|------------|
   | 所属数据源    | 选择创建分区计划所属数据源。默认为当前数据源。 |
   | 分区策略    | 搜索和勾选所属库中的 Range 分区表，并编辑对应的分区策略。 <ul><li> 勾选 **分区策略** 右侧的 **仅显示未设置的表** 时，支持过滤未设置的表。 </li><li> 勾选 Range 分区表时，支持批量设置分区策略。</li><li> 在 **分区策略** 项下，单击编辑图标，支持编辑预创建分区数量、分区间隔、保留时长和命名规则等。<ul><li> **预创建分区数量**：设置将要创建的分区数量。</li><li> **分区间隔**：支持根据所设置的分区时间间隔创建分区，单位：日/月/年。</li><li> **保留时长**：超过保留时长后，创建的分区将被自动清理，单位：日/月/年。 <br> 示例：预创建分区数量  1，分区间隔 1 月，保留时长 1 月，表示对当前表预创建 1 个分区，每隔 1 个月会创建 1 个分区，且超过 1 个月后所创建的分区会被自动清理。<br> ![3](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/400/%E5%88%86%E5%8C%BA%E5%92%8C%E5%BD%B1%E5%AD%90%E8%A1%A8/%E5%88%86%E5%8C%BA%E8%AE%A1%E5%88%92-edit-3.png)</li></ul></li></ul>    |
   | 备注      | 描述项目的业务背景信息，例如变更目的、预期目标等。  |

3. 指定上述信息后，单击面板右下角的 **提交** 按钮完成创建分区计划任务。

4. 任务生成后会自动弹出 **任务中心** 面板，在任务中心可以查看任务审批状态和任务信息。

## 查看分区计划

### **任务信息**

1. 在 **任务中心** 的分区计划列表中，单击操作列中的 **查看** 按钮。

2. 在弹出的 **任务详情** 面板中，单击 **任务信息** 页签查看任务基本信息和设置信息。

   | 信息项 | 说明   |
   |---------|------------------|
   | 任务基本信息  | 显示 **任务状态** 、 **任务编号** 、 **任务类型、所属连接**、 **备注、创建人** 和 **创建时间** 等信息。 |
   | 任务设置信息  | 显示创建分区计划任务时所选择的 Range 分区表的分区策略信息。|

3. 在任务信息面板右下角，单击 **再次发起** ，可以重新发起任务。

### **任务流程** 

1. 在 **任务详情** 面板中，单击 **任务流程** 页签查看 **发起任务状态** 、 **审批状态** 、 **执行状态** 和 **完成结果** 等信息。


2. 在面板右下角，单击 **再次发起** ，可重新发起任务。

### 关联记录

1. 在 **任务详情** 面板中，单击 **关联记录** 页签查看 **任务编号** 、 **所属库** 、 **创建时间** 、 **任务状态** 和 **查看** 操作等信息。

2. 在面板右下角，单击 **再次发起** ，可重新发起任务。

### 任务日志


1. 在 **任务详情** 面板中，单击 **任务日志** 标签查看任务的全部日志和告警日志。


   | 信息项  | 说明     |
   |------|-----------------------------|
   | 全部日志 | 全部日志显示任务的 **INFO** 、 **ERROR** 和 **WARN** 日志等全量信息。 单击 **查找** 、 **下载** 和 **复制** 按钮，可查找信息、下载或复制全部日志信息。        |
   | 告警日志 | 告警日志单独显示任务的 **ERROR** 和 **WARN** 日志。当任务失败时，可通过告警日志查看错误信息。 单击 **查找** 、 **下载** 和 **复制** 按钮，可查找信息、下载或复制告警日志信息。 |

2. 单击 **再次发起** ，可重新发起任务。


## 相关文档

- [SQL 编辑和执行](../500.sql-development/100.sql-editing-and-execution.md)

- [PL 编译和调试](../500.sql-development/200.pl-compile-and-debug.md)

- [命令行窗口](../500.sql-development/300.command-line-window.md)

- [结果编辑与导出](../500.sql-development/400.result-editing-and-exporting.md)

- [执行分析](../500.sql-development/500.perform-analysis.md)

- [生成测试数据](../500.sql-development/600.data-mocking.md)

- [数据库变更管理](../700.database-change-management/600.database-change.md)

- [影子表同步](../700.database-change-management/800.shadow-table-synchronization.md)

- [无锁结构变更](../700.database-change-management/700.table-structure-change.md)
