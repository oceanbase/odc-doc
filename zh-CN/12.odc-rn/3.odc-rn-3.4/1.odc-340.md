ODC V3.4.0
===========================

#RNDate#2022-09-09

本次 9 月发版的 OceanBase 开发者中心（OceanBase Developer Center，ODC）V3.4.0 主要新增登录验证码机制、暗黑主题、数据脱敏、数据连接权限申请审批流程、OAuth2 账号集成，并对导入导出、结果集、表对象管理和 Session 活动标记等功能进行了优化。

版本信息 
-------------------------

* **当前版本：** V3.4.0

* **前置版本：** V3.3.3

* **发版时间：** 2022 年 9 月 9 日

* **支持的升级路径：** 对于 ODC V2.0.0 及之后版本，均可直接升级至本版本。




支持的 OceanBase 数据库版本 
----------------------------------------

OceanBase 开发者中心 V3.4.0 版本支持下述版本的 OceanBase 数据库。

* ODC 通用功能支持 OceanBase 数据库版本

  * OceanBase V1.4.x（主流版 V1.4.7）
  
  * OceanBase V2.0.x
  
  * OceanBase V2.1.x
  
  * OceanBase V2.2.x（主流版 V2.2.7）
  
  * OceanBase V3.1.x（主流版 V3.1.2）
  
  * OceanBase V3.2.x（主流版 V3.2.4）
  
  * OceanBase 社区版（不支持 PL 相关能力）
  

  

* ODC PL 功能支持 OceanBase 数据库版本

  * PL 对象（函数/存储过程/程序包）编译、PL 对象（函数/存储过程）调试和匿名块调试：支持 V2.2.7、V3.0.x 及之后版本，推荐 OceanBase V3.2.3 BP4 及之后版本体验更友好的调试能力。
  
  * PL 对象（函数/存储过程/程序包）运行和匿名块运行：支持 V2.0.x 及之后版本。
  

  




部署要求变更 
---------------------------

ODC V3.4.0 之后版本已删除内部 RPC 监听端口。

功能变更 
-------------------------

### **基础功能**

* 界面改版

  * 支持一键开启无缝切换默认主题/暗黑主题。
  
  * 图标体系重新设计：数据库对象和窗口页签采用面性图标，更具辨识度；SQL 窗口和 PL 窗口采用线性图标，使功能操作更具直观性和高灵活度。

  

* SQL 执行

  * 优化语法高亮，完整高亮当前行。

  * 支持快速定位到错误语句并高亮。

  * SQL 自动补全排序优化。



* 表对象

  * 全面改版，提升功能完整度和交互易用度。

  * 交互升级，为用户提供更具操纵力的功能体验。


  * 对 Oracle 和 MySQL 模式下表对象的区别进行了细粒度的区分：支持设置虚拟列、表达式、索引类型、是否可见；列支持 `SET` 和 `ENUM` 数据类型；列属性支持设置字符集、符号选择、日期是否自动更新 `ON UPDATE CURRENT_TIMESTAMP`。

  * 增加了一系列适配 OceanBase 的规则判断。例如：新建表时如果未新建列，提示用户无法新建表；根据字段类型自动生成该字段的默认长度；已有字段自增属性可以取消不可新增；内置字段属性间的互斥关系，如字段自增则不可设置默认值。


* 结果集

  * 查看格式全面优化，包括数字右对齐、列宽自适应、精度匹配。


  * 支持在指定位置添加新的数据行。

  * 可配置结果集导出数据条数。


  * CSV 格式导出默认配置为 Excel 兼容配置。


  * Excel 格式导出结果集时支持配置是否包含列头、是否导出查询 SQL 语句。


  * Windows 环境下支持显示生僻字。

* 导入导出

  * 导入导出交互改版，单页设置升级为引导式多步骤设置，默认设置优化降低配置成本。


  * 增加导入文件校验，上传文件不匹配时错误提示更友好。


  * 兼容性提升，之前版本 ODC 导出的文件支持导出到新版本 ODC。

  * 支持整库导出，不再需要选择全部对象。


  * 导出时支持配置数据脱敏策略。


  * 客户端版 ODC 去除导入导出文件大小限制。


* 体验改进

  * 对象管理、数据修改等场景下的 SQL 预览支持 SQL 语句格式化。


  * SQL 窗口页签增加正在执行 SQL 语句的标识，清晰展示全局进度。

  * 任务日志展示格式优化，采用不同颜色区分日志区段。


  * Windows 环境下，命令行窗口支持 `Ctrl + C` 复制内容。


  * 支持下载任务日志。



### **管控协同**

* 变更管控

  * 用户可以主动发起数据库连接权限申请，管理员审批后自动授权，管理员同时可以按需授权和撤销授权。


  * 管理员可以为不同数据库连接配置不同的审批流，支持分别配置数据库变更、导入、导出、模拟数据等不同变更场景。


  * 审批节点支持配置为自动审批，配置为自动审批的节点后，审批人可以查看相关的审批任务且无需手动执行审批确认操作。


  * 发起数据库变更任务时，支持设置执行时间。

  * SQL 窗口自动识别需要审批的 SQL 语句，执行时提示发起数据库变更流程。


* 数据脱敏

  * 提供数据静态脱敏功能，支持数据导出、结果集导出等场景开启数据脱敏策略。

  * 提供邮箱、银行卡号、固定电话、手机号、身份证号、姓名等内置脱敏规则。

  * 脱敏策略通过 `库名.表名.字段名` 通配匹配对应的脱敏规则。

  * 支持自定义脱敏规则，提供遮掩、字符替换、保留格式、哈希加密、取整、置空等常用脱敏算法。


* 系统集成

  * 支持 OAuth2 账号集成。



问题修复 
-------------------------

* 导入导出

  * 导入导出多任务并行执行时日志串扰。


  
  * MySQL 模式下，导入导出数据时用户无 mysql schema 会权限报错。

  
  * 单表导入 CSV 列映射有时会失败。


  * 导出数据时如果未选择任何表会报错。


  

* SQL/PL 执行

  * PL 执行 DBMS_OUTPUT 输出长度超过 1MB 时无法展示。


  
  * SQL 查询后切换数据库，结果集导出失败。

  
  * SQL 窗口中执行 PL，当 PL 块内部的 SQL 语句包含 `CASE... WHEN` 时拆句出错。

  
  * Oracle 模式下，timestamp 精度展示错误。


  
  * MySQL 模式下，datetime 字段内容多余显示 `'.0'`。

 
  
  * 导出 Excel 格式的结果集时选择不导出列头不生效，导出的 Excel 文件中仍包含列头。


  
  * 结果集中，列模式下查看大字段显示错误。


  
  * 在个人设置中，切换 SQL 窗口 Session 模式为独立 Session 后，单击提交和回滚数据出现弹窗。


  

* 安全加固

  * 登录验证支持验证码校验。


  
  * 部分资源水平越权加固。


  * 增加数据库类型判断。



  

* 其它模块

  * 连接已断开场景，选择暂不连接后仍反复提示连接已断开。


  
  * 数据库变更任务中的 Delimiter 命令不生效。


  * 新建视图时，自定义字段会被转换成字符串。


  * 查看序列时，格式化 DDL 无效。

  * Oracle 模式下，表的 DDL 查看 COMMENT ON TABLE 语句未加上用户名。


  * MySQL 模式下，修改字段注释会丢失字段的 on update timestamp 属性。


  * 查看任务时，在任务详情面板中切换页签查看任务日志卡顿。


  * 部分国际化文案翻译错误。


  




已知问题 
-------------------------

* Web 版 ODC 中，结构或数据的导入量上限为 2GB，超限文件无法上传。



* Web 版 ODC 中，结构或数据的导出量上限为 2GB，超限会导致最终导出数据不完整。

* 导出任务详情中，导出对象的数据总记录数依赖 OceanBase 数据库视图，并非精准值。


* 需设置 `ob_enable_trace_log` 参数为`on`，否则只显示首次执行的 SQL 的执行计划。





