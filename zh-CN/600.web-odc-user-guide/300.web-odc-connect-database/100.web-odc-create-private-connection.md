# 创建个人连接



## 背景信息

登录 OceanBase 开发者中心（OceanBase Developer Center，ODC）并进入 ODC 首页，可在 **个人连接** 页签中单击 **新建个人连接** 按钮创建个人连接。

创建完成后，再次进入 ODC 时，可在连接列表中查看已保存的数据库连接。

<main id="notice" type='notice'>
    <h4>注意</h4>
    <ul><li>自 ODC V2.3.0 版本起，导入导出功能需在创建连接的高级配置中设置 root@sys 用户，否则会提示无法使用导入导出功能，因自该版本起，导入导出功能查询视图信息时依赖 root@sys 账号。</li>
     <li> 分区信息查看同样依赖 root@sys 账号，因此如需展示表的分区信息须在创建连接的高级配置中设置 root@sys 用户。</li>
     <li> 自 ODC V3.3.0 版本起，ODC 支持独立 Session 模式和共享 Session 模式。独立 Session 模式下，每个 SQL 窗口对应一个数据库会话，所有的修改只会影响当前窗口；共享 Session 模式下，所有的 SQL 窗口共享同一个数据库会话，任意 SQL 窗口的修改均会影响到其它 SQL 窗口。</li>
     <li> 事务手动提交模式下，需设置 <code>ob_trx_idle_timeout</code> 大于等于设置的 SQL 查询超时时间，否则一个事务内两个 SQL 之间的执行间隔超过 <code>ob_trx_idle_timeout</code> 设置的时间，连接会终止。同时需注意 <code>ob_trx_idle_timeout</code> 设置过大会导致该会话占用内存无法及时释放，需谨慎设置。</li></ul>
</main>



## 操作步骤

### 新建单个个人连接

创建个人连接的操作步骤如下所示：


1. 进入 ODC 后，在左侧导航栏的 **连接** 页签中单击 **个人连接** > **新建个人连接** 按钮。

   ![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/410/private%20connection/1.png)

2. 在创建连接页签需填写或选择以下信息，如已拥有 OceanBase 数据库连接串，则以下信息均可从连接串中直接获取（mysql -h **主机名** -P **端口号** -u **数据库用户名@租户名** # **集群名** -D **默认数据库** -p ' **数据库密码** '）或直接使用页签中提供的智能解析工具进行填充：

   ![2](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/410/private%20connection/2.png)

   

   |     信息项     |  说明  |
   |-------------|---------------|
   | 智能解析        | 在文本框中粘贴连接串信息，ODC 会自动识别连接串并在窗口中填充各项连接信息。  |
   | 连接类型        | 选择 **MySQL** 或 **Oracle** （逻辑库仅支持 MySQL 模式）。 |
   | 连接地址        | <ul><li> **主机 IP** ：连接的数据库所在服务器的 IP 信息。</li><li> **端口** ：连接的数据库所在服务器的端口号信息。</li><li> **集群名** ：连接的数据库所在集群的名称（逻辑库无需填写）。</li><li> **租户名** ：连接的数据库所在租户的名称（逻辑库无需填写）。<main id="notice" type='explain'><h4>说明</h4><ul><li>主机名和端口号可从连接的数据库所在租户信息页面获取，如在公有云或 OCP 上创建的租户。</li><li>仅通过 OBProxy 连接 OceanBase 数据库的用户需要填写集群名。</li></ul></main> |
   | 数据库账号       | <ul><li> 数据库用户名：在租户中创建的账号（MySQL 模式下，该账户必须具有访问默认数据库的权限）。</li><li> 数据库密码：在租户中创建的账号的密码。单击数据库密码框后的 **测试连接** 按钮，测试是否能够连接到目标数据库。</li><li> 保存密码：关闭该项，连接信息中将不保存数据库密码信息，每次进入连接或测试连接时，需在弹出的密码弹窗中输入数据库密码以进入连接；开启该项，连接信息将保存数据库密码信息，每次进入连接无需输入数据库密码。</li></ul> <main id="notice" type='notice'><h4>说明</h4><ul><li> 如配置信息有误，会出现异常提示，例如用户或密码不对、网络异常等。</li><li> 用户只可连接本租户下的数据库，否则会报出测试失败的错误。</li><li>ODC V4.0.0 及之后版本支持不填账号密码即可保存连接。</li></ul></main>    |
   | 默认数据库/schema（可选）       | 连接 MySQL 租户中的数据库时，需填写该连接使用的默认数据库（连接 Oracle 租户时无需填写该项）。 <main id="notice" type='explain'><h4>说明</h4><p>MySQL 模式下，如不指定默认库，则默认连接 information_schema 库。 如 information_schema 库连接失败，请将默认数据库设置为该用户有权限的库。</p></main>|
   | sys 租户账号设置 | 选择是否 **使用 sys 租户账号查询租户视图**，勾选后输入 **账号** 和 **密码**。<br> 数据库类型为物理库时，请输入拥有查询 sys 租户视图权限的账号和密码，当 **连接地址** 中已指定 **租户** 为 sys 时，该项被自动填充。<ul><li> **账户** ：拥有 sys 租户视图查看权限的账号。</li><li> **密码** ：账号对应的密码。</li></ul>    输入账户和密码信息后，单击密码框后的 **测试连接** 按钮测试账户信息是否正确。 <main id="notice" type='notice'><h4>说明</h4><ul><li> 自 ODC V2.3.0 之后版本，导入导出功能需在创建连接的高级配置中设置 root@sys 用户。</li><li> 自 ODC V2.4.1 之后版本，导入导出功能查询视图信息时取消 root@sys 账号强依赖（如未配置 root@sys 账号，ODC 部分对象如存储过程和函数等不支持导出功能；如配置 root@sys 账号，通过访问 sys 租户下的视图信息得到最优的数据路由策略，可提升导出速度）。</li><li>  <strong>sys 租户账号和密码</strong> 为集群租户下用户的账号和密码 (账号请勿填入“@sys#集群”)。例如：账号为 root。 </li></ul></main> |
   |启用 SSL|选择是否启用 SSL 加密 SSL 链路，以保证客户端和服务器之间数据的安全传输。<main id="notice" type='notice'><h4>说明</h4><ul><li>通过非加密方式（require none）创建的用户（默认为 require none）可根据需求选择是否开启 SSL。如果勾选 <strong>启用 SSL</strong>，则会创建一个 SSL 连接；如不勾选，则创建的为普通连接。</li><li>通过 SSL 连接方式（require ssl）创建的用户勾选 <strong>启用 SSL</strong> 后，即可创建 SSL 连接；如不勾选，则会连接失败。</li><li>通过 require ssl 创建的用户可不上传证书但必须勾选 <strong>启用 SSL</strong>，否则连接失败。推荐上传证书以验证通信双方身份（非必须）：<ul><li>上传 CA 证书，客户端会校验服务端的身份；</li><li>上传客户端密钥和客户端证书，服务端会校验客户端的身份。</li></ul></li><li>通过 x509 加密方式（require x509）创建的用户必须 <strong>启用 SSL</strong> 且上传 CA 证书以及客户端密钥和客户端证书，客户端和服务端会校验对方身份；不勾选 <strong>启用 SSL</strong> 或不上传证书均无法成功创建连接。</li></ul>通过 ODC 启用 SSL 前，须确认 OBServer 端已开启 SSL；如通过 OBProxy 连接，同样需保证 OBProxy 已开启 SSL。如何在 Server 端开启 SSL，请参见 <a href="https://www.oceanbase.com/docs/enterprise-oceanbase-database-cn-10000000000944716">OBServer 传输加密</a> 和 <a href="https://help.aliyun.com/document_detail/254643.html">公有云 OceanBase SSL 链路加密</a>。</main>|

3. 指定上述信息后，单击面板右下角的 **保存** 按钮，在的弹窗中输入连接名后，单击 **确定** 按钮，即可将当前的配置信息持久保存在 ODC 连接列表中。再次登录 ODC 时，可在连接配置列表中直接选择该连接，保存连接配置时不要求测试连接一定成功。

   ![3](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/410/private%20connection/3.png)

   <main id="notice" type='explain'>
      <h4>说明</h4>
      <p>保存前，可以单击 <strong>测试连接</strong> 进行数据库连接测试，如果数据库用户名和密码正确，则会提示 <strong>连接成功</strong>。</p>
   </main> 
   
  

4. 在页签下方，ODC 同时提供 **复制连接串** 按钮。单击该按钮，ODC 会将当前编辑的连接信息复制为连接串格式以方便获取当前配置的连接信息。

   

5. 如无需保存当前的连接配置，可单击页签下方的 **取消** 按钮，ODC 会弹出弹窗以确认是否退出当前新建连接窗口。

### 批量导入个人连接

ODC V4.1.2 及之后版本支持通过上传配置文件，批量导入个人连接。操作步骤如下：

1. 进入 ODC 后，在 **个人连接** 页签中单击 **批量导入** 按钮。

   ![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/412/1%20batch%20create%20private%20connection.png)

2. 在弹出的 **批量导入** 面板中单击 **下载模板**，填写需要导入的个人连接信息：

   ![2](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/412/2%20batch%20create%20private%20connection.png)

   |     信息项     |  说明  |
   |-------------|------------------------------------------------------------------------------------------------------------------------------|
   | 连接名称        | 必填项。指定该连接的名称。名称不可包含空格且不可重复。  |
   | 连接类型        | 必填项。选择 OB Oracle/OB MySQL/Cloud OB Oracle/Cloud OB MySQL/ODP(Sharding) OB MySQL。 |
   | 主机 IP        | 必填项。指定连接的数据库所在服务器的 IP 信息。<br>主机 IP 可从连接的数据库所在租户信息页面获取，如在公有云或 OCP 上创建的租户。 |
   | 端口        |必填项。指定连接的数据库所在服务器的端口号信息。<br>端口号可从连接的数据库所在租户信息页面获取，如在公有云或 OCP 上创建的租户。  |
   | 集群名        |非必填项。指定连接的数据库所在集群的名称（逻辑库无需填写）。  |
   | 租户名        | 必填项。指定连接的数据库所在租户的名称（逻辑库无需填写）。<br>租户名不可包含空格。 |
   | 用户名        |必填项。在租户中创建的账号（MySQL 模式下，该账户必须具有访问默认数据库的权限）。  |
   | 是否保存密码        | 必填项。选择 true/false。 |
   | 密码        | 指定在租户中创建的账号的密码。密码位空表示密码为空字符串。 |
   | 默认数据库        | 非必填项。连接 MySQL 租户中的数据库时，需填写该连接使用的默认数据库（连接 Oracle 租户时无需填写该项）。<blockquote>**说明**</br>MySQL 模式下，如不指定默认库，则默认连接 information_schema 库。 如 information_schema 库连接失败，请将默认数据库设置为该用户有权限的库。</blockquote>  |
   | sys 租户账号        |非必填项。指定拥有 sys 租户视图查看权限的账号。  |
   | sys 租户密码        | 非必填项。指定账号对应的密码。 |

   <main id="notice" type='explain'>
   <h4>说明</h4>
   <p>批量导入个人连接的模板文件中，无需填写资源组名称、连接状态、只读账号用户名和只读账号密码，该类选项为批量导入公共连接时所需信息。</p>
   </main> 

   ![3](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/412/3%20batch%20create%20private%20connection.png)

3. 单击 **批量导入** 面板中的文件池进入文件资源管理器以选择需要导入的文件，或者直接将文件拖入文件池中以完成文件上传。

4. 单击 **导入**，完成批量导入个人连接信息，并可以在个人连接列表中查看导入的个人连接信息。


