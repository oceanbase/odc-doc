# 影子表同步

## 背景信息

ODC 的影子表同步功能支持根据源表的表结构自动在当前库中创建影子表（表名是在源表名上增加前缀或后缀的方式生成），适用于全链路压测等场景。

本文档旨在介绍如何在 OceanBase 开发者中心（OceanBase Developer Center，ODC）上新建影子表同步。
> **说明**  
> <li> ODC V4.0.0 版本的影子表同步功能仅支持 MySQL 模式，且如果源表中包含二级分区，仅支持 HASH/KEY 的二级模板分区。</li>
> <li> 影子表创建完成后，可以在表对象列表中查看创建的影子表。</li>
> <li> 创建影子表时，如果表名已存在但表结构不同，则会生成同步 SQL 语句，更新影子表结构。</li>


## 新建影子表同步

1. 登录 ODC 后，单击目标连接进入对应的数据库对象管理页面。


2. 在顶部导航栏中，选择 **工具** > **影子表同步**， 以弹出 **新建影子表同步** 面板。

   ![影子表同步-1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/400/%E5%BD%B1%E5%AD%90%E8%A1%A8%E5%90%8C%E6%AD%A5-1.png)

3. 在 **新建影子表同步** 面板中指定以下信息。

   1. 选择对象。

      ![影子表同步-新建1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/412/Shadow%20Table%20Synchronization%20Project1.png)


      | **信息项** | **说明**   |
      |---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
      | 所属库     | 选择创建影子表的所属库并可查看当前连接名。 |
      | 同步范围    | 选择需要同步的表：<ul> <li> **部分表** ：选定的表在当前库中创建影子表。单击搜索框左侧的全选框，支持全选源表。 </li><li>  **全部表**：来源库中所有的表都会在当前库中创建影子表。 </li></ul>  |
      | 影子表名    | 支持以" **前缀** +源表名"或"源表名+ **后缀** "的格式创建影子表名，并且支持自定义前、后缀。    |
      | 同步对象    | 同步部分表时，需在 **同步对象** 中选择源表以同步为影子表。   |


   2. 同步影子表结构分析。

      ![影子表同步-新建2](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/412/Shadow%20Table%20Synchronization%20Project2.png)


      | **信息项** | **说明** |
      |---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
      | 同步的表    | **同步的表** 页签中，显示源表名、影子表名和分析结果，单击 **查看** 支持查看源表结构、影子表结构和结构变更 SQL 语句，单击 **跳过** 支持不同步该影子表。                                                                                                                                     |
      | 不同步的表   | **不同步的表** 页签中，显示源表名、影子表名和分析结果，单击 **取消跳过** 支持同步该影子表。<blockquote> **说明** </br> 选择跳过同步的表，会显示在 **不同步的表** 页签中。</br> 如果影子表名已存在且结构与源表一致，则会自动跳过同步表结构。</blockquote> |
      | SQL 预览  | 显示同步表结构的 SQL 语句。   |
      | 任务设置    | <ul><li>选择审批完成后的 **执行方式** 。<ul><li> **立即同步** ：立即执行同步任务。 </li><li> **定时同步** ：定时执行同步任务。</li></ul></li><li> 选择 **任务错误处理** 方式。<ul><li> **停止任务** ：在执行过程中，遇到出错则中断后面的 SQL 脚本，不再执行。 </li><li> **忽略错误继续执行** ：在执行过程中，跳过当前出错的 SQL 脚本继续执行，并执行完所有 SQL 脚本。</li></ul></li></ul>  |
      | 备注      | 描述项目的业务背景信息，例如变更目的、预期目标等。  |

4. 指定上述信息后，单击面板右下角的 **提交** 按钮完成创建影子表同步任务。


5. 任务生成后会自动弹出 **任务中心** 面板，在任务中心可以查看任务状态和任务信息。详情请参见 [影子表同步任务](../9.web-odc-task-management/6.web-odc-shadow-table-synchronization-task.md)。
   

   ![影子表同步-审批任务3](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/400/%E5%BD%B1%E5%AD%90%E8%A1%A8%E5%90%8C%E6%AD%A5-4.png)


## 相关信息

* [任务流程管理](../../6.web-odc-user-guide/4.web-odc-public-resource-management/4.web-odc-task-process.md)

* [影子表同步任务](../9.web-odc-task-management/6.web-odc-shadow-table-synchronization-task.md)
