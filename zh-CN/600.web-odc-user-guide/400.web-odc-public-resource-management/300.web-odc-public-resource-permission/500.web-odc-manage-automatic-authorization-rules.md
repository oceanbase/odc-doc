# 自动授权规则



## 背景信息

OceanBase 开发者中心（OceanBase Developer Center，ODC）支持拥有特殊权限的用户（系统管理员）定义自动授权规则。拥有该特殊权限的用户可在公共资源管控台内创建/修改/查看/停用自动授权规则。

自动授权是指对满足某些条件的用户，例如姓名、组织部门、登录方式等信息符合某些判断条件，在初次登录或创建用户时自动授予特定的角色或权限，以避免大量冗余授权操作的一项功能。

本文档介绍如何在公共资源管控台上新建和管理自动授权规则。

![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/410/Automatic%20Authorization%20Rules/1.png)

## 新建自动授权规则

### 操作步骤

![2](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/410/Automatic%20Authorization%20Rules/2.1.png)

1. 在 **自动授权规则** 页面的右上角单击 **新建规则** 按钮以弹出 **新建规则** 面板。


2. 在 **新建规则** 面板中需指定以下信息以创建新的规则。

   | 信息项    | 说明|
   |--------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
   | 规则名称   | 指定该规则的名称，不可重名。 |
   | 状态     | 选择 **启用** / **停用** 该授权规则。<br> 规则状态默认为 **启用**，可手动更改为 **停用** 。被停用的规则将不能被访问。 |
   | 触发事件   | 当前只能选择系统内置的事件，不同事件对应不同的触发时机。|
   | 匹配条件（可选）   | 单击 **添加条件**  按钮并指定以下四个字段创建匹配条件。<ul><li> **对象**：存储了触发条件和执行行为所需的信息，可以为复杂嵌套对象，包括 array、list 和 map；也可以为字符串和数字等简单对象。 </li><li> **表达式**：目标在对象中所处的索引，不同类型对象的索引方式有区别。 </li><li> **操作**：支持包含、匹配和等于操作。 </li><li> **值**：目标值。<blockquote>**说明**</br>如未选择添加匹配条件，表示触发选择的事件则会无条件执行动作。</blockquote>|
   | 执行动作（可选）   | 选择 **授予角色** / **授予连接访问权限** 并配置对应的角色名称/公共连接名称。<blockquote>**说明**</br>如未选择执行动作，表示无论是否满足匹配条件均不执行任何动作。</blockquote> |
   | 备注（可选） | 为规则添加备注信息，非必填项。|

3. 指定上述信息后，单击面板右下角的 **新建** 按钮以完成创建规则。

### 应用示例

用户[在 OAuth2 上集成 ODC 且认证登录 ODC 后](../../../1000.system-integration/200.oauth2-account-integration-guide/100.oauth2-overview.md)，假设 OAuth2 授权系统返回的数据结构如下：

```json
{
  "id": 1,
  "name": "username",
  "mail": "example@email.com",
  "memberOf": {
    "department": [
      {
        "name": "deptA",
        "description": "this is a department"
      },
      {
        "name": "deptB",
        "description": "this is a department"
      }
    ],
    "extra": "some other info"
  }
}
```


对于该数据，可以使用不同表达式获取对应的值，示例如下：

| **expression**                 | **result**           |
|--------------------------------|----------------------|
| id                             | 1                    |
| memberOf.department\[0\].name  | deptA                |
| memberOf.department\[\*\].name | \["deptA", "deptB"\] |


当该新用户首次从 OAuth2 登录到 ODC 时，管理员可为其配置自动授权规则。以创建 Grant system_admin for deptB 授权规则为例，memberOf.department 包含任一 name 为 deptB 的元素时，为其授予 system_admin 角色。 具体操作如下图所示：

![3](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/410/Automatic%20Authorization%20Rules/6.png)

## 管理自动授权规则

![4](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/410/Automatic%20Authorization%20Rules/4.png)

进入自动授权规则页面后，信息以列表的形式进行显示：

* 通过刷新按钮可刷新列表信息。

* 通过列表右上角的搜索栏搜索目标规则。

* 支持调整规则列表的列宽。


### 规则列表

规则列表中显示并提供了以下基本信息，且列表中的每一列均提供筛选器以供按列筛选规则。

| 信息项  | 说明|
|------|----------------------------------------------------------------------------------------|
| 规则名称 | 显示规则的名称信息。                                                                             |
| 创建人  | 显示创建发起人。<br> 单击搜索图标![搜索](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5526247461/p416691.jpg)，可搜索和筛选创建人。                 |
| 状态   | 显示规则当前状态： **启用**  或 **停用** 。<br> 单击筛选图标![筛选](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/0583667361/p352180.jpg)，可筛选状态。 |
| 创建时间 | 显示对规则进行 **编辑**  的最新历史操作时间。<br> 支持以升序或降序方式显示创建时间。                           |
| 操作   | 显示 **查看** 、 **编辑** 、 **停用/启用**  和 **删除** 功能键。 |


### 查看规则

![5](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/410/Automatic%20Authorization%20Rules/5.png)

单击自动授权规则信息 **操作** 栏中的 **查看** 按钮，以弹出 **规则信息** 面板。面板中包括以下信息。

| 信息项  | 说明                                             |
|------|------------------------------------------------|
| 规则信息 | 显示 **规则名称、触发事件、匹配条件、执行动作、角色、备注** 等创建规则时您指定的信息。 |
| 操作信息 | 显示 **创建人** 和 **创建时间** 等信息。                     |

### 编辑规则

单击规则信息列表 **操作** 栏中的 **编辑** 按钮，以弹出 **编辑规则** 面板。

**编辑规则** 面板中显示新建规则时所指定的所有信息项，可修改此类信息项以编辑规则。
