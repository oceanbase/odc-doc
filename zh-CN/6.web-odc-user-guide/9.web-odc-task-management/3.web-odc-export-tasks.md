# 导出任务

## 背景信息

OceanBase 开发者中心（OceanBase Developer Center，ODC）支持批量导出数据库对象的结构和数据。

用户可在 ODC 的 **任务中心** > **导出** 页签中新建和查看导出任务。

### 注意事项

OceanBase 开发者中心（ODC）对导出与导入数据大小和保留时间的要求如下：

| 要求                     | 说明                            |
|------------------------|------------|
| Web 版 ODC 对导出的文件大小限制 | 导出时，导出的文件大小不能超过 2GB（压缩前），超出部分无法导出。如需导出大量数据，请使用 [OceanBase OBDUMPER](https://www.oceanbase.com/docs/enterprise/oceanbase-dumper-loader-cn/V3.2.0/10000000000610778)。 |
| 服务器上文件保留时间             | <ul><li> 任务的状态（成功、失败、取消等）不影响文件的生命周期。</li>   <li> 任务永久保留，任务相关的文件默认保留 14 天。</li></ul>    |

任务列表 
-------------------------

<main id="notice" type='explain'>
  <h4>说明</h4>
  <ul>
  <li>任务列表中会显示最近 48 小时内的任务。</li>
  <li>最大支持 3 个导出任务并行运行，后续任务在队列中等待运行。</li>
  </ul>
</main> 

进入目标数据库连接后，单击顶部导航栏中的 **任务中心** 标签弹出任务中心面板，在面板中单击 **导出** 页签显示任务列表。

![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/410/task/export/1.png)

导出任务列表中包含如下信息：


|  **信息项**  |    **说明** |
|-------|-----------------------------------------------------------------|
| 任务编号  | 导出任务编号。 |
| 任务类型  | 显示新建任务时指定的任务类型（导入、导出、模拟数据或数据库变更）。  |
| 所属连接  | 显示目标任务所在的数据库连接名称。 单击筛选图标![筛选](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/0583667361/p352180.jpg)，可筛选所属连接。  |
| 所属数据库 | 显示目标任务所在的数据库。 单击搜索图标![搜索](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5526247461/p416691.jpg)，可搜索和筛选所属数据库。    |
| 创建人   | 创建导出任务的用户。 单击搜索图标![搜索](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5526247461/p416691.jpg)，可搜索和筛选创建人。     |
| 创建时间  | 显示该任务生成的具体日期和时间。    |
| 任务状态  | 显示任务的当前状态（不同状态下提供的管理操作不同）。    |
| 操作    | 提供 **查看** 、 **通过/拒绝** 、 **终止** 和 **下载** 等任务管理操作。 <li> 查看：单击该按钮进入任务详情页面以查看目标任务的 **任务详情** 和 **任务日志**。</li>   <li> 通过/拒绝：单击该按钮审批执行中的任务。</li>   <li> 终止：任务运行中时，单击该按钮终止任务。</li>   <li> 下载：任务成功时，单击该按钮下载导出文件至本地。</li>    |



新建导出任务 
---------------------------

1. 在弹出的任务中心面板中，单击 **导出** 右侧 **+** ，弹出新建导出任务面板。

   ![2](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/410/task/export/2.png)

2. 在导出面板中，选择导出内容。
   
   ![3](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/412/export%20task%201.png)

   如上图所示，ODC 目前支持 **导出结构和数据** 、 **仅导出数据** 和 **仅导出结构** 三种方式。其中导出结构是指导出目标对象的定义语句。可在 **导出内容** 标签下的选择框中选择导出的内容。

3. 选择所属库。

   选择导出对象所在的数据库。该项下同时显示目标任务所在数据库的连接名称。

4. 选择导出范围。

   支持选择 **部分导出** 和 **整库导出**。
   * 部分导出：在 **导出对象** 的 **选择对象** 窗口中勾选需要导出的对象。支持使用搜索框直接进行搜索对象。

   * 整库导出：导出当前库中的所有对象。

5. 进入导出设置面板。

   单击 **下一步：导出设置** 对导出的文件和 sys 租户账号进行设置。

6. 设置数据文件。

   ![4](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/412/export%20task%202.png)

   <main id="notice" type='explain'>
     <h4>说明</h4>
     <p>当 <strong>导出内容</strong> 为仅导出结构时无需设置数据文件。</p>
   </main> 

   |  **设置项**  |    **说明** |
   |-------|-----------------------------------------------------------------|
   | 数据格式  | ODC 目前支持将数据导出为 **CSV 格式** 和 **SQL 格式** 。当 **导出内容** 为 **仅导出结构** 时，只支持导出数据为 SQL 格式。具体格式信息，请参见 [导出导入格式](../../7.client-odc-user-guide/5.client-odc-use-tools/1.client-odc-data-export-and-import/2.client-odc-export-and-import-formats.md)。 |
   | 文件编码  |  ODC 目前支持 **ASCII** 、 **ISO-8859-1** 、 **GB2312** 、 **GBK** 、 **GB18030** 、 **Unicode（UTF-8）** 、 **Unicode（UTF-16）** 、 **Unicode（UTF-32）** 和 **BIG5** 等编码格式。可在 **文件编码** 下拉框中选择需要的编码格式。 |
   | 数据脱敏  | 默认不脱敏，支持选择和管理脱敏策略名称。 **管理脱敏策略** 中，支持添加/编辑/删除策略名称。具体请参见 [数据脱敏管理](../4.web-odc-public-resource-management/6.web-odc-desensitization-rules.md)。  |
   | 单个文件上限  |  当 **导出内容** 为仅导出结构时无需进行单个文件上限设置。<br>支持选择导出的单表数据文件上限。文件大小超过上限后，文件将自动切分；若选择不限制，则不切分文件。 |
   | 数据文件设置  | <ul><li>**使用全局快照** ：勾选该项后 ODC 将导出全局中指定表的最新快照点中的数据，勾选该项可以保证全局数据的一致性。</li><li>**批量提交数量** （SQL 格式）：单击 **导出数据设置** 标签后的 **高级** 按钮，在弹出的列表中可指定该项。选择 **数据格式** 为 SQL 格式时，通过指定批量提交数量，可在导出文件中导出指定数量数据时添加一句 `COMMIT` 命令。</li><li>指定 CSV 格式信息。当 **数据格式** 为 CSV 格式且 **导出内容** 为导出结构和数据时，可指定以下信息：<ul><li>**包含列头** ：该项默认勾选，选择导出数据为 CSV 格式时是否包含列头。</li><li>**空字符串转为空值** ：该项默认勾选，选择导出数据为 CSV 格式时是否将表中的空字符串转换为空值 \\N。</li><li>**字段分隔符** ：设置字段间的分隔符。支持选择 **,** （逗号）、 **;** （分号）和 **:** （冒号）作为字段分割符。同时支持自定义一个字符长度的字符作为分隔符。</li><li>**文本识别符** ：设置文本内容的识别符。支持选择 **'** （单引号）和 **"** （双引号）作为文本识别符。</li><li>**换行符号** ：设置换行符。支持选择 **\\n** 、 **\\r** 和 **\\r\\n** 作为换行符。</li></ul></li></ul>  |

7. 设置结构文件。

   - 当 **导出内容** 为仅导出结构时，支持选择是否 **导出结果合并为一个 SQL 文件**。勾选该项后，会合并 DDL 并导出为一个 SQL 文件。

   - 在该项下选择是否在 **Create 语句前添加 Drop 语句** 。勾选该项后，在导出对象结构文件时，在对象的 `CREATE` 语句前均会添加对应的 `DROP` 语句。

8. 设置任务执行方式。

   在该项下选择 **立即执行** / **定时执行** 。

9. 设置 sys 租户账号。

   1. 在该项下选择是否 **使用 sys 租户账号提升导出速度** ，勾选后输入 **账户** 和 **密码** 。

   2. 输入账户和密码信息后，单击密码框后的 **测试连接** 按钮测试账户信息是否正确。默认自动填入连接设置的账号，如连接失败，建议修改密码用于此次导出。

      <main id="notice" type='notice'>
        <h4>注意</h4>
        <ul>
        <li><strong>sys 租户账号和密码</strong> 为集群租户下用户的账号和密码 (账号请勿填入"@sys#集群")。例如：账号 odc，密码 *******。</li>
        <li>如未配置 <strong>sys</strong> 租户账号，会导致导入导出速度下降。</li>
        </ul>
      </main>

10. 保留当前配置。

    指定所有信息后，勾选面板左下角的 **保留当前配置** 以保留当前部分数据文件和结构文件配置。

11. 生成导出任务。

    指定所有信息后，单击面板右下角的 **导出** 按钮以生成导出任务。

12. 查看导出任务。

    任务生成后会自动弹出 **任务中心** 面板，在任务中心可以查看任务信息并下载导出的数据结构文件。

    ![5](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/410/task/export/5.png)



查看导出任务 
---------------------------

### 任务信息 

1. 在 **导出** 任务列表中，单击 **查看** 按钮。

2. 弹出目标任务的任务详情面板，单击 **任务信息** 标签查看任务基本信息、导出文件信息和导出对象信息。


|  信息项   |                                                             说明                                                              |
|--------|-----------------------------------------------------------------------------------------------------------------------------|
| 任务基本信息 | 显示 **任务编号** 、 **连接名** 、 **模式名** 、 **任务类型** 、 **创建时间** 、 **重试次数** 和 **重试时间** 等信息。                                            |
| 导出文件信息 | 显示创建导出任务时您选择的 **导出内容** 、 **数据格式** 、 **文件编码** 、 **导出数据设置** 、 **导出结构设置** **、** **任务错误处理** 和 **sys 租户账号配置** 等信息。               |
| 导出对象信息 | 显示该任务中您选择的对象在导出或导出数据时的完成情况，包括  **对象名称** 、 **对象类型** 、 **结构处理状态** 、 **数据总记录数** 、 **数据已处理数** 和 **数据处理状态** 等信息。 |



### 任务流程 

1. 在 **导出** 任务列表中，单击 **查看** 按钮。

2. 在弹出目标任务的任务详情面板中，单击 **任务流程** 标签查看 **发起任务** 、 **审批** 和 **执行** 状态等信息。

### 任务日志 

1. 在 **导出** 任务列表中，单击 **查看** 按钮。

2. 弹出目标任务的任务详情面板，单击 **任务日志** 标签查看任务的全部日志和告警日志。


| 信息项  |                                     说明                                      |
|------|-----------------------------------------------------------------------------|
| 全部日志 | 显示任务的 **INFO** 、 **ERROR** 和 **WARN** 日志等全量信息。                              |
| 告警日志 | 告警日志单独显示任务的 **ERROR** 和 **WARN** 日志。 当任务失败时，可查看告警日志以获得错误信息。 |

同时，工具栏提供了以下功能键：

| 功能  |                            说明                             |
|------|-----------------------------------------------------------|
| 查找 | 单击该按钮查找日志信息。        |
| 下载 | 单击该按钮下载日志信息。 |
| 复制 | 单击该按钮复制日志信息。 |

## 下载导出的文件

在 **导出** 任务列表中，单击 **下载** 按钮下载导出的文件至本地。

![download](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/413/export.png)
