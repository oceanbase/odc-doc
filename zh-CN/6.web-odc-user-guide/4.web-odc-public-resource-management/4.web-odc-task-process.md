# 任务流程管理 



背景信息 
-------------------------

OceanBase 开发者中心（OceanBase Developer Center，ODC）支持拥有特殊权限的用户（拥有公共资源管控台权限的管理员）定义变更任务流程，其他只读权限的用户可根据所定义的任务流程发起 [变更任务](../../6.web-odc-user-guide/9.web-odc-task-management/1.web-odc-task-management-overview.md)。

拥有该特殊权限的用户可在公共资源管控台内修改/查看/停用变更任务流程，支持的任务流程包括导入、导出、模拟数据、数据库变更和申请连接权限。

![任务流程图](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/0008191561/p416627.png)

## **新建任务流程** 

以在 ODC 中新建申请连接权限为例。具体操作步骤如下：

1. 进入 **公共资源管控台** 页面后，在左侧导航栏中单击 **任务流程** 以进入任务流程管理页面。

2. 在 **任务流程管理** 页面右上角，选择需要创建的任务流程类型后单击 **新建流程** 按钮，以弹出 **新建任务流程** 面板。

   ![任务流程管理-新建任务流程1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/340/%E4%BB%BB%E5%8A%A1%E6%B5%81%E7%A8%8B%E7%AE%A1%E7%90%86-%E6%96%B0%E5%BB%BA%E4%BB%BB%E5%8A%A1%E6%B5%81%E7%A8%8B1.png)

3. 在 **新建任务流程** 面板中需指定以下设置流程信息。
   ![任务流程管理-新建任务流程2](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/340/%E4%BB%BB%E5%8A%A1%E6%B5%81%E7%A8%8B%E7%AE%A1%E7%90%86-%E6%96%B0%E5%BB%BA%E4%BB%BB%E5%8A%A1%E6%B5%81%E7%A8%8B2.png)

   | **信息项** | **说明**                          |
   |---------|---------------------------------|
   | 任务流程名称  | 指定该任务流程的名称。                     |
   | 任务类型    | 选择任务类型，包括导入、导出、模拟数据、数据库变更和权限申请。 |
   | 风险等级数   | 选择风险等级数。                        |
   | 任务审批流程  | 设置审批节点。                         |
   | 流程有效期   | 指定审批和执行有效期。执行超时，任务将过期。          |
   | 任务流程状态  | 选择启用/停用任务流程。                    |
   | 备注（可选）  | 填写相关说明信息。                       |

4. 单击 **下一步：关联连接** 选择关联的公共连接。

5. 选择 **关联连接**。

   ![任务流程管理-新建任务流程3](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/340/%E4%BB%BB%E5%8A%A1%E6%B5%81%E7%A8%8B%E7%AE%A1%E7%90%86-%E6%96%B0%E5%BB%BA%E4%BB%BB%E5%8A%A1%E6%B5%81%E7%A8%8B3.png)

   | **信息项** | **说明**                        |
   |---------|-------------------------------|
   | 部分公共连接  | 选择部分公共连接时，需要添加公共连接/资源组中的公共连接。 |
   | 全部公共连接  | 关联全部公共连接。                     |

6. 指定上述信息后，单击面板右下角的 **新建** 按钮完成创建任务流程。

管理任务流程 
---------------------------

![公共资源管控台-任务流程](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/340/%E4%BB%BB%E5%8A%A1%E6%B5%81%E7%A8%8B%E7%AE%A1%E7%90%86-%E7%AE%A1%E7%90%86%E4%BB%BB%E5%8A%A1%E6%B5%81%E7%A8%8B1.png)

进入 **公共资源管控台** 页面后，在左导航栏中单击 **任务流程** ，进入 **任务流程管理** 页面。

在 **任务流程管理** 页面中，任务流程信息以列表的形式进行显示：

* 通过刷新按钮可刷新列表信息。
* 通过列表右上角的 **设置优先级** 选择目标任务流程执行顺序，创建任务时会关联优先级最高的任务流程。
* 勾选任务流程名称复选框![复选框](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5526247461/p416674.jpg)，支持批量删除。

### 任务流程管理列表 

任务流程管理列表中的基本信息如下所示，且列表中的每一列均提供筛选器以供按列筛选任务流程。


|  信息项   |                                                                                                                      说明                                                                                                                       |
|--------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 任务流程名称 | 显示任务流程名称。                                                                                                                                                                                                                                     |
| 任务类型   | 显示任务类型。 单击筛选图标![筛选](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/0583667361/p352180.jpg)，可筛选任务类型（导入/导出/模拟数据/数据库变更）。                                                                                           |
| 风险等级数  | 显示设置的风险等级数。 默认风险等级数为 1，可自定义，最大值为 10。只有数据库变更才能设置风险等级，其它类型的任务只能有一个风险等级。                                                                                                                                                                                          |
| 创建人    | 显示任务发起人。 单击搜索图标![搜索](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5526247461/p416691.jpg)，可搜索和筛选创建人。                                                                                                          |
| 状态     | 显示任务流程状态。 单击筛选图标![筛选](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/0583667361/p352180.jpg)，可筛选所属任务状态（启用/停用）。                                                                                                  |
| 创建时间   | 显示上一次对任务流程操作的时间。                                                                                                                                                                                                                              |
| 操作     | 显示 **查看** 、 **编辑** 和 **停用** / **启用** 功能键。<br> - 查看：查看当前任务流程详情。<br> - 编辑：修改当前任务流程详情。  <br> - 停用：直接修改任务流程的状态。   |



### 查看任务流程 

![任务流程-查看](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/340/%E4%BB%BB%E5%8A%A1%E6%B5%81%E7%A8%8B%E7%AE%A1%E7%90%86-%E6%9F%A5%E7%9C%8B%E4%BB%BB%E5%8A%A1%E6%B5%81%E7%A8%8B2.png)

在 **任务流程管理** 页面中，单击对应任务流程列表 **操作** 项下的 **查看** 按钮，以弹出 **任务流程详情** 面板。


#### **查看** 流程信息 


| 信息项      | 说明                                                                                        |
|----------|-------------------------------------------------------------------------------------------|
| 任务流程基本信息 | 显示 **任务流程名称** 、 **任务类型** 、 **风险等级数** 、 **审批有效期** 、 **执行等待有效期** 、 **执行有效期**  和 **备注**  信息。 |
| 等级       | 显示任务等级，包括审批节点、审批角色和可审批人。                                                                  |
| 创建人      | 显示任务发起人。                                                                                  |
| 创建时间     | 显示创建任务流程的操作时间。                                                                            |



#### **查看相关连接** 

| 信息项    | 说明           |
|--------|--------------|
| 关联连接   | 显示关联的公共连接信息。 |
| 任务流程状态 | 显示任务流程状态。    |



### 编辑任务流程 

![任务流程-编辑](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/340/%E4%BB%BB%E5%8A%A1%E6%B5%81%E7%A8%8B%E7%AE%A1%E7%90%86-%E7%BC%96%E8%BE%91%E4%BB%BB%E5%8A%A1%E6%B5%81%E7%A8%8B3.png)

在 **任务流程管理** 页面中，单击对应任务流程列表 **操作** 项下的 **编辑** 按钮，以弹出 **编辑任务流程** 面板。


|  信息项   |                                                                                                                                                                                                   说明                                                                                                                                                                                                    |
|--------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 任务流程名称 | 同组织架构下任务流程名称不可重复，由数字、中文、英文字母组成，最大不超过 110 个字符。                                                                                                                                                                                                                                                                                                                                                          |
| 任务类型   | 数据库变更的任务子类包括：Update/Delete/Insert/Select/Create/Drop/Alter/其它。                                                                                                                                                               |
| 风险等级数  | 默认风险等级数为 1，可自定义，最大值为 10（推荐设置为 3）。 只有数据库变更才能设置风险等级，其它类型的任务只能有一个风险等级。                                                                                                                                                                                                                                                                                                                                                                      |
| 任务审批流程 | - 此项仅针对数据库变更流程，默认风险等级数为 1，只有一个等级，该等级包含用户选择的所有任务子类, 不对变更的数据量做限制，默认需管理员审批，可自定义该等级的审批节点（节点数和审批角色）。<br>     - 按如果风险等级数不为1，各等级可分别定义，定义项包括： **任务子类** 、 **变更的 SQL 数量范围** 和 **设置审批节点** 。    |
| 流程有效期  | 定义审批有效时间，如超过定义的时间长度，审批自动终止； 默认 24h（1天），可自定义，最大值 240h（10天）。<br> - 审批有效期：审批超时，任务将过期。 <br>  - 执行等待有效期：手动执行前等待超时，任务将过期。 <br>  - 执行有效期：执行超时，任务将过期。                                                                                                                  |
| 任务流程状态 | 选择 **启用** 或 **停用** 任务流程状态（已停用的变更流程不可再发起任务）。                                                                                                                                                                                                                                                                                                                                                             |
| 备注     | 填写对该流程的说明，最大不超过 200 个字符。                                                                                                                                                                                                                                                                                                                                                                                |

### 设置任务流程优先级

1. 在任务流程管理页面，单击 **设置优先级** ，进入设置优先级面板。

   ![任务流程管理-设置任务流程优先级1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/340/%E4%BB%BB%E5%8A%A1%E6%B5%81%E7%A8%8B%E7%AE%A1%E7%90%86-%E8%AE%BE%E7%BD%AE%E4%BB%BB%E5%8A%A1%E6%B5%81%E7%A8%8B%E4%BC%98%E5%85%88%E7%BA%A71.png)

2. 在 **设置优先级** 面板中，选择任务类型后，在流程优先级列表中单击和拖拽 **排序** 项下的图标以调整任务流程名称排序。{#769951702eqxi}

   > **说明**  
   > 任务将按管理员在公共资源管控台的 设置优先级 中设置的优先级排序匹配执行。
   > 同一连接关联多个流程时，连接内的任务将按排序的优先级匹配流程。

   ![任务流程管理-设置任务流程优先级2](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/340/%E4%BB%BB%E5%8A%A1%E6%B5%81%E7%A8%8B%E7%AE%A1%E7%90%86-%E8%AE%BE%E7%BD%AE%E4%BB%BB%E5%8A%A1%E6%B5%81%E7%A8%8B%E4%BC%98%E5%85%88%E7%BA%A72.png)

3. 调整完成后，单击面板右下角的 **保存** 按钮完成优先级设置。

### 停用任务流程 

单击目标连接 **操作** 项下的 **停用** 按钮会弹出是否停用任务流程对话框，单击 **确定**，停用任务流程。

> **说明**
> 被停用的自定义任务流程，在任务发起页面不会再显示该任务流程（即不可再发起关于该任务流程的任务）。