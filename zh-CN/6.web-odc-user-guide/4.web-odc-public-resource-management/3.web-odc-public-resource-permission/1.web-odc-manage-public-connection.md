# 公共连接管理



## 背景信息

OceanBase 开发者中心（OceanBase Developer Center，ODC）支持创建个人连接和公共连接。个人连接是用户获得数据库连接信息后在 ODC 中自己创建的连接，但在企业的实际应用场景中出于安全考虑并不能分享数据库连接信息给所有用户，因此管理员可在 ODC 中创建公共连接，并将公共连接添加到指定资源组，从而用户能够访问资源组下的公共连接。

登录 OceanBase 开发者中心（OceanBase Developer Center，ODC）并进入 ODC 首页，可单击 **管控台** 页签进入管控台页面创建公共连接。

创建完成后，可在公共连接管理列表中查看已保存的公共连接。



## 新建公共连接

![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/410/public%20connection/1.png)

1. 在 **公共连接管理** 页面右上角，单击 **新建公共连接** 按钮，以弹出 **新建公共连接** 面板。

2. 在 **新建公共连接** 面板中需指定以下信息以创建新的公共连接。


   |     信息项     | 说明 |
   |-------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
   | 连接名称        | 指定该连接的名称。 |
   | 所属资源组      | 单击文本框，在弹出的下拉列表中选择已创建好的资源组，更多关于资源组的详细信息，请参见 [资源组管理](../3.web-odc-public-resource-permission/2.web-odc-manage-resource-groups.md)。  |
   | 连接状态        | 连接状态默认是 **启用** ，可以手动更改为 **停用** 。被停用的连接将不能被访问。 |
   | 智能解析        | 在文本框中粘贴连接串信息，ODC 会自动识别连接串并在窗口中填充各项连接信息。 |
   | 连接类型        | 选择 **MySQL** 或 **Oracle** （逻辑库仅支持 MySQL 模式）。 |
   | 连接地址        | <ul><li> **主机 IP** ：连接的数据库所在服务器的 IP 信息。  </li><li> **端口** ：连接的数据库所在服务器的端口号信息。</li><li> **集群名** ：连接的数据库所在集群的名称（逻辑库无需填写）。</li><li> **租户名** ：连接的数据库所在租户的名称（逻辑库无需填写）。</li></ul><blockquote>  **说明** <br>  主机名和端口号可从连接的数据库所在租户信息页面获取，如在公有云或 OCP 上创建的租户。</blockquote>    |
   | 读写账号        | 指定拥有数据库读写权限的 **账号** 和 **密码** 信息。指定后，拥有读写权限的 ODC 账户将使用该数据库账号访问数据库。 单击数据库密码框后的 **测试连接** 按钮，测试账户信息是否正确。 |
   | 只读账号        | 指定拥有数据库只读权限的 **账号** 和 **密码** 信息。指定后，拥有只读权限的 ODC 账户将使用该数据库账号登录数据库。 单击数据库密码框后的 **测试连接** 按钮，测试账户信息是否正确。  |
   | 默认数据库       | 连接 MySQL 租户中的数据库时，需填写该连接使用的默认数据库（连接 Oracle 租户中的数据库时则无需填写该项）。 | 
   | sys 租户账号设置 | 选择是否 **使用 sys 租户账号查询租户视图**，勾选后输入 **账号** 和 **密码**。<br> 数据库类型为物理库时，请输入拥有查询 sys 租户视图权限的账号和密码，当 **连接地址** 中已指定 **租户** 为 sys 时，该项被自动填充。<ul><li> **账户** ：拥有 sys 租户视图查看权限的账号。</li><li> **密码** ：账号对应的密码。</li></ul>    输入账户和密码信息后，单击密码框后的 **测试连接** 按钮测试账户信息是否正确。<blockquote> **说明** <ul><li> 自 ODC V2.3.0 之后版本，导入导出功能需在创建连接的高级配置中设置 root@sys 用户。</li><li> 自 ODC V2.4.1 之后版本，导入导出功能查询视图信息时取消 root@sys 账号强依赖（如未配置 root@sys 账号，ODC 部分对象如存储过程和函数等不支持导出功能；如配置 root@sys 账号，通过访问 sys 租户下的视图信息得到最优的数据路由策略，可提升导出速度）。</li><li>  **sys 租户账号和密码** 为集群租户下用户的账号和密码 (账号请勿填入“@sys#集群”)。例如：账号为 root。 </li></ul></blockquote>  |
   |启用 SSL|选择是否启用 SSL 加密 SSL 链路，以保证客户端和服务器之间数据的安全传输。<blockquote>**说明**</br><ul><li>通过非加密方式（require none）创建的用户（默认为 require none）可根据需求选择是否开启 SSL。如果勾选 **启用 SSL**，则会创建一个 SSL 连接；如不勾选，则创建的为普通连接。</li><li>通过 SSL 连接方式（require ssl）创建的用户勾选 **启用 SSL** 后，即可创建 SSL 连接；如不勾选，则会连接失败。<br>通过 require ssl 创建的用户可不上传证书但必须勾选 **启用 SSL**，否则连接失败。推荐上传证书以验证通信双方身份（非必须）：<ul><li>上传 CA 证书，客户端会校验服务端的身份；</li><li>上传客户端密钥和客户端证书，服务端会校验客户端的身份。</li></ul></li><li>通过 x509 加密方式（require x509）创建的用户必须 **启用 SSL** 且上传 CA 证书以及客户端密钥和客户端证书，客户端和服务端会校验对方身份；不勾选 **启用 SSL** 或不上传证书均无法成功创建连接。</li></ul>通过 ODC 启用 SSL 前，须确认 OBServer 端已开启 SSL；如通过 OBProxy 连接，同样需保证 OBProxy 已开启 SSL。如何在 Server 端开启 SSL，请参见 [OBServer 传输加密](https://www.oceanbase.com/docs/enterprise-oceanbase-database-cn-10000000000944716) 和 [公有云 OceanBase SSL 链路加密](https://help.aliyun.com/document_detail/254643.html)。</blockquote>|

3. 指定上述信息后，单击面板右下角的 **新建** 按钮完成创建公共连接。

   > **注意**<br> 
   > 单击 **新建** 按钮，如出现以下情况会弹出风险提示对话框：
   > <ul><li> 读写账号不连通。</li><li> 读写账号权限不足。</li><li> 只读账号不连通。</li><li> 只读账号超出权限。</li></ul>

  


## 管理公共连接

![2](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/410/public%20connection/2.png)

进入 **公共连接管理** 页面后，连接信息以列表的形式进行显示：

* 通过列表上方的搜索图标![search](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5526247461/p416691.jpg)查找目标连接。

* 通过![filter](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/0583667361/p352180.jpg)按照类型、权限和标签筛选连接。按钮通过刷新按钮可刷新列表信息。 

* 通过[sort](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/%E6%8E%92%E5%BA%8F.png)排序连接。 

* 通过![update](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/%E5%88%B7%E6%96%B0.jpg)刷新列表信息。 

* 支持调整连接列表的列宽。

### 公共连接列表 

公共连接列表中的基本信息如下所示，且列表中的每一列均提供筛选器以供按列筛选连接。


|  信息项  |  说明 |
|-------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 连接 ID | 公共连接序号。 单击 **连接 ID** ，可根据 ID 号进行升序或降序。 |
| 连接名   | 显示连接的名称、主机名/端口号信息，单击连接名称可进入数据库连接。 其中连接名称前会通过图标显示该连接的状态：绿色图标表示有效连接；红色图标表示失效连接；灰色图标表示连接未保存数据库密码信息。 单击 **连接名** ，可升序或降序。|
| 集群    | 显示并筛选集群信息。 单击筛选图标![筛选](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/0583667361/p352180.jpg)，可筛选所属集群信息（勾选 **空** ，可筛选出无所属集群的连接）。|
| 租户    | 显示并筛选租户信息。 单击筛选图标![筛选](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/0583667361/p352180.jpg)，可筛选所属租户信息（勾选 **空** ，可筛选出无所属资源组的连接）。 |
| 所属资源组 | 显示并筛选连接所属的资源组的名称。 单击筛选图标![筛选](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/0583667361/p352180.jpg)，可筛选所属资源组的连接（勾选 **空** ，可筛选出无所属资源组的连接）。  |
| 状态    | 显示当前连接状态（ **启用/停用** ）。 单击筛选图标![筛选](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/0583667361/p352180.jpg)，可筛选状态。  |
| 操作时间  | 显示上一次对公共连接进行 **编辑** 操作的时间，如未对公共连接进行过 **编辑** 操作则显示的时间为公共连接的创建时间。|
| 操作    | 显示 **查看** 、**管理权限**、**编辑**、**复制** 和 **停用/启用** 功能键。 <ul><li> 查看：查看当前连接的配置信息。</li><li>管理权限：添加/删除可访问连接的用户。</li><li> 编辑：修改当前连接的配置信息。</li><li> 复制：根据当前连接的配置信息，快速修改和新建连接。</li><li> 停用/启用：直接修改连接的状态。</li></ul>   |

### 查看公共连接

![3](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/410/public%20connection/3.png)

单击公共连接信息 **操作** 项下的 **查看** 按钮，以弹出 **公共连接信息** 面板。面板中包括 **连接详情**、**相关用户** 和 **相关流程** 三个页签。


| 信息项  |   说明 |
|------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 连接详情 | <ul><li> 连接信息：显示 **所属区域**、 **连接模式**、 **连接名称**、 **所属资源组**、 **连接地址**、 **数据库读写用户名**、**数据库只读用户名** 和 **查询 sys 租户账号** 等创建连接时您指定的信息。</li><li> 操作信息：显示 **创建人** 、 **创建时间** 和 **更新时间** 等信息。</li><li> 删除用户：单击页签中的 **删除公共连接** 按钮将删除当前连接，删除连接后，被赋予该连接的用户将无法访问当前连接。    |
| 相关用户 | 显示了可访问当前公共连接的用户 **姓名** 、 **角色** 和 **权限** 等信息。</li></ul>  |
| 相关流程|显示可管理的任务信息。|
| 编辑   | 在 **公共连接信息** 面板中，单击右下角的 **编辑** 按钮可进入 **编辑公共连接** 面板。 |

### 编辑公共连接 

1. 单击公共连接信息列表 **操作** 项下的 **编辑** 按钮，以弹出 **编辑公共连接** 面板。   

2. **编辑公共连接** 面板中会显示在新建公共连接时所指定的所有信息项（其中 **数据库类型** 、 **所属区域** 和 **连接模式** 项在连接被创建后不可修改）。   

3. 编辑信息完成后，单击 **保存** 按钮。

