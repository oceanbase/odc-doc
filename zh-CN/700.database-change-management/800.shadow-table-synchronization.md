# 影子表同步

## 背景信息

ODC 的影子表同步功能支持根据源表的表结构自动在当前库中创建影子表（表名是在源表名上增加前缀或后缀的方式生成），适用于全链路压测等场景。

本文档旨在介绍如何在 ODC 上新建和查看影子表同步。

<main id="notice" type='explain'>
  <h4>说明</h4>
  <ul>
  <li>ODC V4.0.0 及之后版本的影子表同步功能仅支持 MySQL 模式，且如果源表中包含二级分区，仅支持 HASH/KEY 的二级模板分区。</li>
  <li>影子表创建完成后，可以在表对象列表中查看创建的影子表。</li>
  <li>创建影子表时，如果表名已存在但表结构不同，则会生成同步 SQL 语句，更新影子表结构。</li>
  </ul>
</main>


## 新建影子表同步

示例：在数据源 mysql410 下数据库 odc_test 中创建影子表 employee_t。

| 信息项 | 示例值 |
| ------ | ------ |
|所属数据源|mysql4.2.0 |
|数据库名称|odc_test|
|源表名称|employee|
|影子表名称|employee_t|

1. 在 SQL 开发窗口的 **工单** 页签中单击 **影子表同步** > **新建影子表同步**。

   ![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/420/sql-development/9.shadow%20table/1.png)


2. 在 **新建影子表同步** 面板中指定以下信息。

   1. 选择对象。

      ![2](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/420/sql-development/9.shadow%20table/2.png)


      | **信息项** | **说明**   |
      |---------|------------|
      | 数据库     | 选择创建影子表的所属库并可查看当前数据源名称。 |
      | 同步范围    | 选择需要同步的表：<ul> <li> **部分表** ：选定的表在当前库中创建影子表。单击搜索框左侧的全选框，支持全选源表。 </li><li>  **全部表**：来源库中所有的表都会在当前库中创建影子表。 </li></ul>  |
      | 影子表名    | 支持以" **前缀** +源表名"或"源表名+ **后缀** "的格式创建影子表名，并且支持自定义前、后缀。    |
      | 同步对象    | 同步部分表时，需在 **同步对象** 中选择源表以同步为影子表。   |


   2. 单击下一步进行同步影子表结构分析。

      ![3](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/420/sql-development/9.shadow%20table/3.png)


      | **信息项** | **说明** |
      |---------|-----------------|
      | 同步的表    | **同步的表** 页签中，显示源表名、影子表名和分析结果，单击 **查看** 支持查看源表结构、影子表结构和结构变更 SQL 语句，单击 **跳过** 支持不同步该影子表。  |
      | 不同步的表   | **不同步的表** 页签中，显示源表名、影子表名和分析结果，单击 **取消跳过** 支持同步该影子表。<blockquote> **说明** </br> 选择跳过同步的表，会显示在 **不同步的表** 页签中。</br> 如果影子表名已存在且结构与源表一致，则会自动跳过同步表结构。</blockquote> |
      | SQL 预览  | 显示同步表结构的 SQL 语句。   |
      | 任务设置    | <ul><li>选择审批完成后的 **执行方式** 。<ul><li> **立即同步** ：立即执行同步任务。 </li><li> **定时同步** ：定时执行同步任务。</li></ul></li><li> 选择 **任务错误处理** 方式。<ul><li> **停止任务** ：在执行过程中，遇到出错则中断后面的 SQL 脚本，不再执行。 </li><li> **忽略错误继续执行** ：在执行过程中，跳过当前出错的 SQL 脚本继续执行，并执行完所有 SQL 脚本。</li></ul></li></ul>  |
      | 描述      | 描述项目的业务背景信息，例如变更目的、预期目标等。  |

4. 指定上述信息后，单击面板右下角的 **提交** 按钮完成创建影子表同步任务。


5. 任务生成后会自动弹出 **任务中心** 面板，在任务中心可以查看任务审批状态和任务信息。

   ![](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/420/sql-development/9.shadow%20table/4.png)

## 查看影子表同步任务

### 任务信息

1. 在 **任务中心** 的影子表同步列表中，单击列表操作列中的 **查看** 按钮。

2. 在弹出的任务详情面板中，单击 **任务信息** 页签查看任务基本信息和设置信息。

3. 在任务信息面板右下角，单击 **再次发起** ，可以重新发起任务。

### 任务流程

1. 在弹出的任务详情面板中，单击 **任务流程** 页签查看 **发起任务状态** 、 **审批状态** 、 **执行状态** 和 **完成结果** 等信息。

2. 在面板右下角，单击 **再次发起** ，可重新发起任务。

### 任务日志 

1. 在任务详情面板中，单击 **任务日志** 标签查看任务的全部日志和告警日志。

   | 信息项  | 说明  |
   |------|-----------------------------------------------------------------------------------------------------------------------------|
   | 全部日志 | 全部日志显示任务的 **INFO** 、 **ERROR** 和 **WARN** 日志等全量信息。<br> 单击 **查找** 、 **下载** 和 **复制** 按钮，可查找信息、下载或复制全部日志信息。        |
   | 告警日志 | 告警日志单独显示任务的 **ERROR** 和 **WARN** 日志。当任务失败时，可通过告警日志查看错误信息。<br> 单击 **查找** 、 **下载** 和 **复制** 按钮，可查找信息、下载或复制告警日志信息。 |


2. 单击 **再次发起** ，可重新发起任务。

## 相关文档

- [SQL 编辑和执行](../500.sql-development/100.sql-editing-and-execution.md)

- [PL 编译和调试](../500.sql-development/200.pl-compile-and-debug.md)

- [命令行窗口](../500.sql-development/300.command-line-window.md)

- [结果编辑与导出](../500.sql-development/400.result-editing-and-exporting.md)

- [执行分析](../500.sql-development/500.perform-analysis.md)

- [生成测试数据](../500.sql-development/600.data-mocking.md)

- [数据库变更管理](../700.database-change-management/600.database-change.md)

- [分区管理](../800.data-Lifecycle-management/300.partition-scheme.md)

- [无锁结构变更](../700.database-change-management/700.table-structure-change.md)
