# 版本发布记录

本次 1 月发版的 OceanBase 开发者中心（OceanBase Developer Center，ODC）V4.1.0 主要新增 SQL 检查和自动运行，并对连接管理、权限管理、SQL 窗口、表对象管理、导入导出和交互界面等功能进行了优化。

## 版本信息 

* **当前版本：** V4.1.0

* **前置版本：** V4.0.2

* **发版时间：** 2023 年 01 月 12 日

* **支持的升级路径：** 对于 ODC V2.0.0 及之后版本，均可直接升级至本版本。




## 支持的 OceanBase 数据库版本

OceanBase 开发者中心 V4.1.0 版本支持下述版本的 OceanBase 数据库。

* ODC 通用功能支持 OceanBase 数据库版本

  * OceanBase V1.4.x（主流版 V1.4.7）
  
  * OceanBase V2.0.x
  
  * OceanBase V2.1.x
  
  * OceanBase V2.2.x（主流版 V2.2.7）
  
  * OceanBase V3.1.x（主流版 V3.1.2）
  
  * OceanBase V3.2.x（主流版 V3.2.4）

  * OceanBase V4.0.0
  
  * OceanBase 社区版
  

  

* ODC PL 功能支持 OceanBase 数据库版本

  * PL 对象（函数/存储过程/程序包）编译、PL 对象（函数/存储过程）调试和匿名块调试：支持 V2.2.7、V3.0.x 及之后版本，推荐 OceanBase V3.2.3 BP4 及之后版本体验更友好的调试能力。
  
  * PL 对象（函数/存储过程/程序包）运行和匿名块运行：支持 V2.0.x 及之后版本。



## 功能变更


* SQL 检查

  * 新增 SQL 规范检查，SQL 窗口中编辑 SQL 语句、创建数据库变更任务和创建表时支持进行 SQL 规范检查。

* 自动运行

  * 新增 SQL 计划任务，支持定时周期性执行用户创建的 SQL 脚本，以满足周期性执行用户所需的数据库开发和运维任务。

* 权限管理

  * 新增自动授权规则，公共资源管控台管理员对满足某些条件的用户，例如姓名、组织部门、登录方式等信息符合某些判断条件，在初次登录或创建用户时自动授予特定的角色或权限，以避免大量冗余授权操作的一项功能。

  * 支持在管控台对公共连接列表进行权限管理。

  * 支持在管控台对角色进行资源管理、系统操作权限的配置。

* 管控台

  * 操作记录入口移动至安全审计菜单下。
   

* 结果集编辑

  * 支持使用 Shift 快捷键选择指定列中的多行数据。

  * 增强结果集可编辑范围，多表关联查询时如果包含其中一张表的 ROWID ，则结果集也支持编辑。

* 导入导出

  * 使用客户端版 ODC 进行导出时，支持将备份文件直接导出到本地目录。

  * 导入导出支持 OceanBase V4.0.0 版本。

  * 导入/导出时，支持勾选 **保留当前配置** 以保存当前配置作为默认配置。

  * 导出表结构时去除部分 sys 账号依赖，大部分数据库对象的导入导出不再依赖 sys 账户。无 sys 账户存在的限制如下：

    * OceanBase MySQL 租户无法导出序列定义。

    * OceanBase V2.2.70 之前的版本无法导出表组定义。

    * OceanBase V2.2.30 及之前的版本的 Oracle 租户无法导出索引定义。

    * OceanBase V2.2.70 之前的版本无法导出唯一索引的分区信息。

    * OceanBase V2.2.70 ~ V4.0.0.0 版本的 Oracle 租户无法导出分区表的唯一索引定义。

* SQL 执行

  * 支持通过会话变量 `ob_query_timeout` 设置查询超时时间，无超时限制。

  * 手动提交模式下，ODC V4.0.0 及之后版本支持根据是否有未提交事务区分状态显示 **提交** 和 **回滚** 按钮。

  * 优化执行记录中 DB 耗时中 Execute SQL 指标，提供准确的网络耗时统计。

  * 支持展示姓名中常见的生僻字，非国标编码字通过显码字体展示。

  * 对象拖拽生成语句交互支持记住选项不再提示选择语句类型。

* 连接管理

  * 更改首页连接列表的数据组织形式。

  * 支持 SSL 加密。

  * 公共连接列表支持置顶连接，打标签操作。

  * 历史连接入口调整为一级菜单。

* 数据库对象

  * 增加对数据库表的记录数以及数据大小信息的展示。

* 安全加固

  * 部分场景下可能出现敏感信息明文透出。

  * 升级 Spring Cloud Config Server 版本到 V2.2.6.RELEASE。

  * 升级 Jackson 相关组件版本到 V2.14.1。

  * 升级 Jettison 版本到 V1.5.2。

  * 阿里专有云接入 RASS 模块。

  * 去除 Java JWT 依赖。

  * 去除 javacsv 依赖。

  * 升级 Hadoop Common 组件版本至 V3.3.3。

  * 升级 netty-all 组件版本至 V4.1.44.Final。

  * 升级 MINA Core 组件版本至 2.1.1。

  * 剥离 Log4j 依赖库。


## 问题修复 

* 任务中心

  * 公共只读连接关联流程执行策略显示错误。
  
  * 公共只读连接相关流程详情页面打开缓慢。

  * 存储的任务数据量过大导致任务列表刷新缓慢。

* 数据库变更

  * 回滚数据库变更任务前后下载得到的查询结果不同。

* 导入导出

  * 整库导出表组时报错。
  
  * 无法使用 ISO8859-1 字符集导入/导出数据。
  
  * 导出包含 Float 数据类型的表时存在 Float 精度损失。

* 管控台
  
  * 无法验证已存在的公共连接的权限。

* SQL 执行
  
  * 无法执行包含 emoji 表情等特殊字符的 SQL 语句。

  * SELECT 语句的 WHERE 条件中如果包含 `*` 字符且指定投影字段会执行报错。

  * 某些特定 PL 场景下，在 SQL 窗口中执行 SQL 语句时出现无法正常分句导致执行错误且无忽略方法。

  * OceanBase MySQL 模式下，值为 0000-00-00 00:00:00 的 DATETIME 数据显示为 NULL。

  * 在 SQL 窗口中执行 DML 类型的语句成功后，日志页签中展示影响的行数为 0。

* 结果集

  * 下载结果集时使用数据脱敏，查询结果集元数据出错。

  * 结果集数据编辑过程中，修改某个数据后再取消修改，点击确认后将会报错。

  * 编辑 CLOB 类型的列时，上传数据中存在 `;` 导致编辑报错。

* 数据库对象

  * OceanBase V3.1.2 之前的版本，如果表注释为空，则查看表详情时报错`预期外异常`。

  * 查看表数据和视图数据时，无法查看位于第 1000 行之后的记录。

  * OceanBase Oracle 模式下查看表 DDL 时，如果包含唯一索引，DDL 中会重复输出一次。

  * 访问无权限的 MySQL 数据库时，存储过程、函数等数据对象报错。

  * OceanBase 1.4.79 之前的版本查看表对象报错。

  * OceanBase 2.2.50 之前的版本查看表/视图数据时白屏。

  * 查看大容量表/视图数据内容时加载缓慢，可能会导致连接的 OceanBase 租户 CPU 使用率过高。

  * 已开启回收站但白屏删除的表对象无法进入回收站。

  * 创建视图时如果关联表的表名中包含 `&`，则无法显示 `&` 后的表名。

  * `information_schema` 数据库下，OceanBase MySQL 租户查看任意视图对象属性时，**基本信息** 显示为空。

  * 左侧导航栏中的对象结构树无法显示程序包中名称包含中文的子程序。

* 影子表

  * 新建影子表同步时，同步对象中取消/选择一个源表并单击下一步后一直处于加载状态。

  * 全局唯一索引未包含所有一级分区键，导致生成的 SQL 不正确。

* PL 调试

  * 程序包调试过程中，如果存在子程序互相调用，跳入后打断点将抛出异常。

* 用户管理

  * ODC V4.0.2 版本用户无法修改自己的密码。



## 已知问题

* 客户端版 ODC 不支持安装在中文目录名中。

* 导出包含虚拟列的表时，导出的数据文件和内容显示异常。

* Web 版 ODC 中，结构或数据的导入量上限为 2GB，超限文件无法上传。

* Web 版 ODC 中，结构或数据的导出量上限为 2GB，超限会导致最终导出数据不完整。

* 导出任务详情中，导出对象的数据总记录数依赖 OceanBase 数据库视图，并非精准值。

* 需设置 `ob_enable_trace_log` 参数为 `on`，否则只显示首次执行的 SQL 的执行计划。