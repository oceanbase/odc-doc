# 部署 Web 版 ODC

<main id="notice" type='explain'>
   <h4>说明</h4>
   <p>环境要求请参见 <a href="../../200.odc-overview/500.product-limits.md">使用限制</a>。</p>
</main> 

## 部署单节点 Web 版 ODC

1. 在 OceanBase MySQL 模式下申请一个租户。租户大小为 2C8G，租户名称无限制。示例：租户所在的集群名称为 `odc_cluster`，租户名称为 `odc_tenant`。

2. 在租户下创建数据库和用户以作为 ODC 元数据库，用户名、密码和元数据库名称无限制。示例：数据库命名为 `odc_metadb`，数据库用户名和密码均为 `obodc`。

3. 记录元数据库的名称、用户名、密码、租户名称和租户所在的集群名称，在部署 ODC 时此类信息需要作为参数传入。

4. 单节点 Web 版 ODC 部署环境配置，按照 ODC 用户数量的经验值：

    | ODC 用户数量 | 服务器类型|服务器数量|功能最低配置|性能最低配置|
    | ------------- |-------------   |-------------|-------------|-------------|
    | 20  |  ODC Docker 部署服务器 |1 台|2C，4GB 内存|4C，16GB 内存|

5. 有关安装与启动 Docker，请参见 [绑定挂载](https://docs.docker.com/storage/bind-mounts/)。

6. 下载 ODC 镜像以获取所需的镜像架构版本：

   - [\[X86 镜像\]](https://obodc-front.oss-cn-beijing.aliyuncs.com/ODC%204.2.1/obodc4.2.1.tar.gz)<br>

   - [\[ARM 镜像\]](https://obodc-front.oss-cn-beijing.aliyuncs.com/ODC%204.2.1/obodc4.2.1_arm.tar.gz)

7. 在宿主机上获取镜像文件后，在命令行工具中运行下述语句加载镜像：

   语法格式：

   ```javascript
   gunzip -c obodc-{$version}.tar.gz | docker load
   ```

   示例：

   ```javascript
   #!/usr/bin/env bash
   docker run -v /var/log/odc:/opt/odc/log   -v /var/data/odc:/opt/odc/data \
   -d -i --net host --cpu-period 100000 --cpu-quota 400000 --memory 8G --name "obodc" \
   -e "DATABASE_HOST=xxx.xx.xx.xx" \
   -e "DATABASE_PORT=60805" \
   -e "DATABASE_USERNAME=[用户名]@[租户名称]#[集群名称]" \
   -e "DATABASE_PASSWORD=******" \
   -e "DATABASE_NAME=odc_metadb" \
   -e "ODC_ADMIN_INITIAL_PASSWORD=******" \
   oceanbase/odc-server:4.2.1-20231009
   ```

   参数说明如下表所示：

   |  参数  |   说明   |
   |-------------|--------------|
   |-v                                        | <ul><li>宿主机的 `/var/log/odc`  目录映射到 ODC 容器内的 `/opt/odc/log` 目录。 `/var/log/odc` 为宿主机的目录，如不存在需先创建，创建目录的参考命令 `mkdir -p /var/log/odc`。</li><li>宿主机的 `/var/data/odc` 目录挂载到 ODC 容器内的 `/opt/odc/data` 目录。`/var/data/odc` 为宿主机的目录，可自定义，如不存在需先创建，创建目录的参考命令 `mkdir -p /var/data/odc`。</li></ul>|
   | --net                                    | 指定容器的网络配置，指定该参数值为 `host` 即直接使用宿主机网络。 您也可以使用 `--publish`（`-p`）参数配置端口映射，但是部分环境可能出现因为 Docker 内 DNS 解析出错而启动容器失败，此时请使用 `--net host` 方式启动 Docker。 |
   | --cpu-period --cpu-quota | <li> `---cpu-period` 用来指定容器对 CPU 的使用要在多长时间内做一次重新分配。单位：微秒。</li>   <li> `---cpu-quota` 用来指定在这个周期内，最多可以有多少时间用来运行当前容器。单位：微秒。 </li>   配合使用可指定容器使用的 CPU 核数。`cpu-quota`/`cpu-period` 的值即为 Docker 可以使用的 CPU 核数，示例语句中 400000/100000=4 表示最多可以使用 4 个核。 |
   | --memory | 设置容器使用的内存最大值。  |
   | --name                                   | 指定容器名称。  |
   | DATABASE_HOST                            | 元数据库 IP 地址。  |
   | DATABASE_PORT                            | 元数据库端口号。|
   | DATABASE_USERNAME                        | 元数据库用户名。OceanBase 数据库用户名的格式：`db_user@tenant_name#cluster_name`。 |
   | DATABASE_PASSWORD                        | 连接数据库的密码。   |
   | DATABASE_NAME                            | 元数据库名。  |
   | ODC_PROFILE_MODE                         | 指定模式，默认指定：`alipay`。|
   | ODC_ADMIN_INITIAL_PASSWORD               | 指定 ODC 管理员账号的初始密码。|

   <main id="notice" type='notice'>
      <h4>注意</h4>
      <ul>
      <li>Shell 环境下，字符串中包含 <code>!</code>、<code>$</code> 等特殊字符时，变量值需要使用单引号。例如：<code>DATABASE_PASSWORD='11111!'</code>。</li>
      <li>参数 <code>ODC_ADMIN_INITIAL_PASSWORD</code> 用于指定 ODC 管理员账号的初始密码。设置的初始密码需要须满足以下条件：<ul><li>至少 2 个数字。</li><li>至少 2 个大写字母。</li><li>至少 2 个小写字母。</li><li>至少 2 个特殊字符，特殊字符的范围为 ._+@#$%。</li><li>不包含空格和其他特殊字符，长度为 8-32。</li></ul></li>
      </ul>
   </main>

## 登录 Web 版 ODC

1. [打开浏览器](https://www.oceanbase.com/docs/enterprise-odc-doc-cn-10000000002088520) 并输入 Web 版 ODC 的访问地址后按回车键。

2. 输入账号和密码，登录 Web 版 ODC。

   <main id="notice" type='explain'>
      <h4>说明</h4>
      <p>您还可以通过 SSO 集成自动维护账号信息，详情请参见  《系统集成.单点登录》请参见 <a href="../../1000.system-integration/100.sso-integration.md">单点登录配置</a>。</p>
   </main> 

   ![logon](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/420/quickstart/webodc/web%20user%204.2.png)

3. 选择工作空间。
  
   ![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/420/web%20odc%20logon%201.png)

4. 登录 ODC 并进入首页的连接管理页面后，在导航栏左下角的 **我的** 中会显示当前登录的账户名，在弹出的下拉菜单中单击 **退出** 按钮将返回 ODC 登录界面，可重新登录其它 ODC 账号。
   
   ![3](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/420/web%20odc%20logon%203.png)


## 相关文档

- [部署 Web 版 ODC](../../1100.deployment-guide/100.deployment-overview.md)
