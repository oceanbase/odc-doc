# 影子表同步任务 

## 背景信息

OceanBase 开发者中心（OceanBase Developer Center，ODC）支持用户向公共资源管控台管理员申请创建影子表同步的权限。

用户在 **任务中心** 创建影子表同步任务后，管理员会在任务中心的任务列表中审批任务，申请权限的用户可以在任务中心的任务列表中查看任务信息和审批状态。

## 任务列表

> **说明**  
> 任务列表会显示最近 48 小时内的任务。

进入目标数据库连接后，单击顶部导航栏中的 **任务中心** 页签弹出任务中心面板，在面板中单击 **影子表同步** 页签显示任务列表。

![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/410/client/task/shadow%20table/1.png)

进入影子表同步任务页签后，列表中会显示以下信息并且支持筛选和排序：

| **信息项** | **说明**    |
|---------|----------------------------------------------------------------------------------------------------|
| 任务编号    | 显示任务编号。  |
| 任务类型    | 显示新建任务时指定的任务类型。   |
| 所属连接    | 显示目标任务所在的数据库连接名称。 单击筛选图标![筛选](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/0583667361/p352180.jpg)，可筛选所属连接。                                                                                                                                                                                               |
| 所属数据库   | 显示目标任务所在的数据库。单击搜索图标![搜索](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5526247461/p416691.jpg)，可搜索和筛选所属数据库。                                                                                                                                                                                               |
| 创建人     | 创建任务的用户。单击搜索图标![搜索](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5526247461/p416691.jpg)，可搜索和筛选创建人。                                                                                                                                                                                                      |
| 创建时间    | 显示该任务生成的具体日期和时间。                                                                                                                                                                                                                                                            |
| 任务状态    | 显示任务的当前状态（不同状态下提供的管理操作不同）。                                                                                                                                                                                                                                                  |
| 操作      | 提供 **查看** 、 **通过/拒绝**  和  **终止** 等任务管理操作。<ul><li> 查看：单击该按钮进入任务详情页面以查看目标任务信息。 </li><li> 通过/拒绝：单击该按钮审批任务。 </li><li> 终止：任务运行中时，单击该按钮终止任务。 </li></ul> |


## 新建影子表同步任务

1. 在弹出的任务中心面板中，单击 **影子表同步** 右侧 **+**，弹出新建影子表同步任务面板。
    
    ![2](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/410/client/task/shadow%20table/2.png)


2. 在 **新建影子表同步** 面板中，输入以下信息。

   a. 选择对象。

      ![3](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/410/client/task/shadow%20table/3.png)


      | **信息项** | **说明**  |
      |---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
      | 所属库     | 选择创建影子表的所属库并可查看当前连接名。                                                                                                                                                      |
      | 同步范围    | 选择需要同步的表：<ul><li> **部分表** ：选定的表在当前库中创建影子表。单击搜索框左侧的全选框，支持全选源表。 </li><li> **全部表** ：来源库中所有的表都会在当前库中创建影子表。 </li></ul> |
      | 影子表名    | 支持以" **前缀** +源表名"或"源表名+ **后缀** "的格式创建影子表名，并且支持自定义前、后缀。                                                                                                                     |
      | 同步对象    | 同步部分表时，需在 **同步对象** 中选择源表以同步为影子表。                                                                                                                                           |

   b. 同步影子表结构分析。

      ![4](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/410/client/task/shadow%20table/4.png)

      | **信息项** | **说明**     |
      |---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
      | 同步的表    | **同步的表** 页签中，显示源表名、影子表名和分析结果，单击 **查看** 支持查看源表结构、影子表结构和结构变更 SQL 语句，单击 **跳过** 支持不同步该影子表。                                                                                                                                     |
      | 不同步的表   | **不同步的表** 页签中，显示源表名、影子表名和分析结果，单击 **取消跳过** 支持同步该影子表。<blockquote> **说明**</br> 选择跳过同步的表，会显示在 **不同步的表** 页签中。 如果影子表名已存在且结构与源表一致，则会自动跳过同步表结构。 </blockquote>                                                                     |
      | SQL 预览  | 显示同步表结构的 SQL 语句。                                                                                                                                                                                                           |
      | 任务设置    | <ul><li>选择审批完成后的 **执行方式** 。<ul><li> **立即同步** ：立即执行同步任务。 </li><li> **定时同步** ：定时执行同步任务。</li></ul></li><li> 选择 **任务错误处理** 方式。<ul><li> **停止任务** ：在执行过程中，遇到出错则中断后面的 SQL 脚本，不再执行。 </li><li> **忽略错误继续执行** ：在执行过程中，跳过当前出错的 SQL 脚本继续执行，并执行完所有 SQL 脚本。</li></ul></li></ul>  |
      | 备注      | 描述项目的业务背景信息，例如变更目的、预期目标等。   |

3. 单击 **提交** ，完成任务申请。

   > **说明**  
   > 任务申请创建完成后，任务会自动匹配管理员在公共资源管控台中创建的申请影子表同步任务流程。  
   > 任务将按管理员在公共资源管控台的 **设置优先级** 中设置的优先级排序匹配执行。

## 查看影子表同步任务

### 任务信息

1. 在 **任务中心** > **影子表同步** 的任务列表页签中，单击任务列表操作列中的 **查看** 按钮弹出目标任务的任务详情面板。

2. 在 **任务详情** 面板中，单击 **任务信息** 页签查看任务基本信息和设置信息。

   | **信息项** | **说明**    |
   |---------|---------------------------------------------------------------------------------------------------------|
   | 任务基本信息  | 显示 **任务状态** 、 **任务编号** 、 **任务类型** 、 **所属连接** 、 **所属数据库** 、 **执行方式** 、 **任务错误处理、备注、创建人** 和 **创建时间** 等信息。 |
   | 任务设置信息  | 显示创建影子表同步任务时所选择的 **同步表/不同步表/** 待执行的 **SQL 脚本** 信息。|


3. 在任务信息面板右下角，单击 **再次发起** ，可以重新发起任务。

### **任务流程**

1. 在 **任务详情面板** 中，单击 **任务流程** 页签查看 **发起任务状态** 、 **审批状态** 、 **执行状态** 和 **完成结果** 等信息。


2. 在面板右下角，单击 **再次发起** ，可重新发起任务。

### 任务日志 

1. 在 **任务详情** 面板中，单击 **任务日志** 标签查看任务的全部日志和告警日志。

   | 信息项  | 说明  |
   |------|-----------------------------------------------------------------------------------------------------------------------------|
   | 全部日志 | 全部日志显示任务的 **INFO** 、 **ERROR** 和 **WARN** 日志等全量信息。<br> 单击 **查找** 、 **下载** 和 **复制** 按钮，可查找信息、下载或复制全部日志信息。        |
   | 告警日志 | 告警日志单独显示任务的 **ERROR** 和 **WARN** 日志。当任务失败时，可通过告警日志查看错误信息。<br> 单击 **查找** 、 **下载** 和 **复制** 按钮，可查找信息、下载或复制告警日志信息。 |


2. 单击 **再次发起** ，可重新发起任务。



## 相关信息

* [新建影子表同步](../../7.client-odc-user-guide/5.client-odc-use-tools/4.client-odc-shadow-table-synchronization.md)