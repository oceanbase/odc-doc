# 批量导出与导入 




## 概述 


OceanBase 开发者中心（OceanBase Developer Center，ODC）支持批量导出和导入数据库对象的结构和数据。

进入数据库连接后，单击顶部导航栏中的 **工具** 标签，在弹出的下拉菜单中单击 **导出** 或 **导入** 标签进入导出设置与导入设置面板。

OceanBase 开发者中心（ODC）对导出与导入数据大小和保留时间的要求如下：

| 要求                     | 说明       |
|------------------------|--------------|
| 服务器上文件保留时间             | <li> 任务的状态（成功，失败，取消等）不影响文件的生命周期。</li>   <li> 任务永久保留，任务相关的文件默认保留 14 天。</li>    |



## 批量导出 


在 **新建导出** 面板中，可以选择同时导出多个对象到指定格式的文件中。

![批量导出](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/410/tool/export%20and%20import/batch%20export%20and%20import/export1.png)



以在 ODC 中批量导出员工表（employee）和薪资表（salary）为例。具体操作步骤如下：

### 步骤 1：选择导出内容

如上图所示，ODC 目前支持 **导出结构和数据** 、 **仅导出数据** 和 **仅导出结构** 三种方式。其中导出结构是指导出目标对象的定义语句。可在 **导出内容** 标签下的选择框中选择导出的内容。

### 步骤 2：选择所属库 

选择导出对象所在的数据库。该项下同时显示目标任务所在数据库的连接名称。

### 步骤 3：选择导出范围 

支持选择 **部分导出** 和 **整库导出** 。

* 部分导出：在 **导出对象** 的 **选择对象** 窗口中勾选需要导出的对象。支持使用搜索框直接进行搜索对象。

  

* 整库导出：导出当前库中的所有对象。

  




### 步骤 4：进入导出设置面板 

单击 **下一步：导出设置** 对导出的文件和 sys 租户账号进行设置。

### 步骤 5：设置数据文件 

![批量导出-2](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/410/tool/export%20and%20import/batch%20export%20and%20import/export2.png)

<main id="notice" type='notice'>
   <h4>说明</h4>
   <p>当 <strong>导出内容</strong> 为仅导出结构时无需设置数据文件。</p>
</main> 

1. 选择数据格式。

   ODC 目前支持将数据导出为 **CSV 格式** 和 **SQL 格式**。当 **导出内容** 为 **仅导出结构** 时，只支持导出数据为 SQL 格式。具体格式信息，请参见 [导出导入格式](../1.client-odc-data-export-and-import/2.client-odc-export-and-import-formats.md)。
   

2. 选择文件编码。

   ODC 目前支持 **ASCII** 、 **ISO-8859-1** 、 **GB2312** 、 **GBK** 、 **GB18030** 、 **Unicode（UTF-8）** 、 **Unicode（UTF-16）** 、 **Unicode（UTF-32）** 和 **BIG5** 等编码格式。可在 **文件编码** 下拉框中选择需要的编码格式。

3. 选择 **单个文件上限**。
   
   当 **导出内容** 为仅导出结构时无需进行单个文件上限设置。

   支持选择导出的单表数据文件上限。文件大小超过上限后，文件将自动切分；若选择不限制，则不切分文件。

4. 进行数据文件设置。
   
   * **使用全局快照** ：勾选该项后 ODC 将导出全局中指定表的最新快照点中的数据，勾选该项可以保证全局数据的一致性。

     
   
   * **批量提交数量** （SQL 格式）：单击 **导出数据设置** 标签后的 **高级** 按钮，在弹出的列表中可指定该项。选择 **数据格式** 为 SQL 格式时，通过指定批量提交数量，可在导出文件中导出指定数量数据时添加一句 `COMMIT` 命令。

     
   
   * 指定 CSV 格式信息。当 **数据格式** 为 CSV 格式且 **导出内容** 为导出结构和数据时，可指定以下信息：

     * **包含列头** ：该项默认勾选，选择导出数据为 CSV 格式时是否包含列头。

       
     
     * **空字符串转为空值** ：该项默认勾选，选择导出数据为 CSV 格式时是否将表中的空字符串转换为空值 \\N。

       
     
     * **字段分隔符** ：设置字段间的分隔符。支持选择 **,** （逗号）、 **;** （分号）和 **:** （冒号）作为字段分割符。同时支持自定义一个字符长度的字符作为分隔符。

       
     
     * **文本识别符** ：设置文本内容的识别符。支持选择 **'** （单引号）和 **"** （双引号）作为文本识别符。

       
     
     * **换行符号** ：设置换行符。支持选择 **\\n** 、 **\\r** 和 **\\r\\n** 作为换行符。



### 步骤 6：设置结构文件 

- 当 **导出内容** 为仅导出结构时，支持选择是否 **导出结果合并为一个 SQL 文件**。勾选该项后，会合并 DDL 并导出为一个 SQL 文件。

- 在该项下选择是否在 **Create 语句前添加 Drop 语句** 。勾选该项后，在导出对象结构文件时，在对象的 `CREATE` 语句前均会添加对应的 `DROP` 语句。

### 步骤 7：设置任务执行方式 

在该项下选择 **立即执行**。

### 步骤 8：设置 sys 租户账号 

1. 在该项下选择是否 **使用 sys 租户账号提升导出速度** ，勾选后输入 **账户** 和 **密码** 。

   

2. 输入账户和密码信息后，单击密码框后的 **测试连接** 按钮测试账户信息是否正确。默认自动填入连接设置的账号，如连接失败，建议修改密码用于此次导出。

<main id="notice" type='explain'>
  <h4>注意</h4>
  <ul>
  <li><strong>sys 租户账号和密码</strong> 为集群租户下用户的账号和密码 (账号请勿填入"@sys#集群")。如图所示： <a href="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/9555336361/p348256.png">sys 租户账号配置</a></li>
  <li>如未配置 <strong>sys</strong> 租户账号，会导致导入导出缺少索引。</li>
  </ul>
</main>
   

### 步骤 9：保留当前配置

勾选 保留当前配置，保留当前部分数据文件和结构文件配置。


### 步骤 10：生成导出任务

指定所有信息后，单击面板右下角的 **导出** 按钮以生成导出任务，并将备份文件直接导出到本地目录。

### 步骤 11：查看导出任务 

任务生成后会自动弹出 **任务中心** 面板，在任务中心可以查看任务信息并下载导出的数据结构文件。详情请参见 [导出任务](../../8.client-odc-task-management/3.client-odc-export-tasks.md)。


## 批量导入 


在 **新建导入** 面板中，可以选择同时导入结构和数据到多个数据库对象中。

![批量导入](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/410/tool/export%20and%20import/batch%20export%20and%20import/import1.png)



以在 ODC 中批量导入 ZIP 压缩文件（6000219_import_file）为例，其中包含员工表（employee）和视图（salary）。具体操作步骤如下：

### 步骤 1：选择导入文件格式

如上图所示，ODC 目前支持批量导入 **CSV 文件** 、 **SQL 文件** 和 **ZIP 压缩文件** 。可在 **导入文件格式** 标签下的下拉框中选择需要的文件格式。具体格式信息，请参见 [导出导入格式](../1.client-odc-data-export-and-import/2.client-odc-export-and-import-formats.md)。

<main id="notice" type='explain'>
  <h4>说明</h4>
  <ul>
  <li><strong>导入文件格式</strong>为 CSV 文件时，支持跳过首行字段列头字段。</li>
  <li><strong>导入文件格式</strong>为 ZIP 压缩文件时，支持导入单表或者多表和跳过已存在的结构。</li>
  </ul>
</main>

### 步骤 2：上传导入文件

单击文件池进入文件资源管理器以选择需要导入的文件，或者直接将文件拖入文件池中以完成文件上传。上传的文件格式需要与所选择的导入文件格式相同，ZIP 压缩文件支持上传 .zip 结尾的文件、SQL 文件支持上传 .sql 文件以及 CSV 文件支持上传 .csv 文件。

### 步骤 3：选择文件编码

ODC 目前支持 **ASCII** 、 **ISO-8859-1** 、 **GB2312** 、 **GBK** 、 **GB18030** 、 **Unicode（UTF-8）** 、 **Unicode（UTF-16）** 、 **Unicode（UTF-32）** 和 **BIG5** 等编码格式。可在 **文件编码** 下拉框中选择需要的编码格式。

### 步骤 4：进入导入设置面板 

单击 **下一步：导入设置** 对导入的文件和 sys 租户账号进行设置。

### 步骤 5：选择导入内容

![批量导入-2](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/410/tool/export%20and%20import/batch%20export%20and%20import/import2.png)

当 **导入格式** 为 ZIP 压缩文件时需指定该项。ODC 目前支持 **仅导入数据** 、 **仅导入结构** 和 **导入数据和结构** 三种方式 **。** 其中导入结构指是否要导入对象的定义语句。可在 **导入内容** 标签下的选择框中选择需要导入的内容。

### 步骤 6：选择所属库

选择导入对象所在的数据库。该项下同时显示目标任务所在数据库的连接名称。

### 步骤 7：设置导入数据

当 **导入格式** 为 ZIP 压缩文件且 **导入内容** 不为仅导入结构时需设置导入数据。该项包含以下设置项：

* **导入前清空数据** ：勾选该项后，导入数据时将首先清空目标对象中原有的数据。

  

* **批量提交数量** ：单击 **导入数据设置** 标签后的 **高级** 按钮，在弹出的列表中可指定该项。通过指定批量提交数量，可在导入文件中导入指定数量数据时添加一句 `COMMIT` 命令。

  

* **不导入的数据类型** （可选）：可以通过该项指定导入数据时要跳过的数据类型。MySQL 和 Oracle 下可跳过的类型不同，支持多选。

  




### 步骤 8：设置导入结构

当 **导入内容** 为仅导入数据时，该项不可被指定。在该项下选择当对象结构已存在时的操作。选择 **跳过** 操作则在导入时跳过导入文件中的结构定义语句直接导入数据，该项会保留对象中的原数据。选择 **替换** 操作时则执行导入文件中的结构定义语句以重新创建并替换原对象，该项会清空对象中的原数据。

### 步骤 9：设置执行方式 

支持选择 **立即执行**。

  




### 步骤 10：设置 sys 租户账号 

1. 在该项下选择是否 **使用 sys 租户账号提升导出速度** ，勾选后输入 **账户** 和 **密码** 。

   

2. 输入账户和密码信息后，单击密码框后的 **测试连接** 按钮测试账户信息是否正确。默认自动填入连接设置的账号，如连接失败，建议修改密码用于此次导出。

   <main id="notice" type='explain'>
     <h4>注意</h4>
     <ul>
     <li><strong>sys 租户账号和密码</strong> 为集群租户下用户的账号和密码 (账号请勿填入"@sys#集群")。如图所示： <a href="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/9555336361/p348256.png">sys 租户账号配置</a></li>
     <li>如未配置 <strong>sys</strong> 租户账号，会导致导入导出缺少索引。</li>
     </ul>
   </main> 
   
### 步骤 11：保留当前配置

勾选 **保留当前配置**，保留当前部分数据文件和结构文件配置。



### 步骤 12：生成导入任务 

指定所有信息后，单击面板右下角的 **提交** 按钮以生成导入任务。

### 步骤 13：查看导入任务 

任务生成后会自动弹出 **任务中心** 面板，在任务中心可以查看任务信息，详情请参见 [导入任务](../../8.client-odc-task-management/2.client-odc-import-tasks.md)。

