# Execution analysis

The OceanBase Developer Center (ODC) SQL window provides a user interface for processing data. Within this window, you can evaluate SQL statements, review execution details, and analyze the full execution timeline. This topic uses the `employee` table as an example to demonstrate how to evaluate SQL queries.

## Execution plan

1. In the SQL window, enter the SQL statement to query the data in the `employee` table.

   <img src="https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/431/500.sql-development/500.perform-analysis/Execution%20Profile/0.1EN.png" width="900">

   ```sql
    SELECT `emp_no`, `birthday`, `name`, `time`, `test_col`, `status`, `age`, `state` FROM `employee`;
   ```

2. As shown in the image above, select the SQL statement and click the Execution Plan icon. This allows you to estimate the execution data before running the SQL statement (EXPLAINPLAN). Note that the estimated execution data may differ slightly from the actual results after execution.

   <img src="https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/431/500.sql-development/500.perform-analysis/Execution%20Profile/0.2EN.png" width="900">

3. On the **Plan Details** page, click **Text View** to switch to a formatted display of the plan.

## Execution details

<main id="notice" type='explain'>
<h4>Note</h4>
<ul>
<li>For <strong>OceanBase versions prior to V4.2.4</strong>, when executing SQL statements, you can view basic execution details, time statistics, I/O statistics, SQL execution statements, plan statistics, and outlines through the <strong>Execution Details</strong> tab on the results page.</li>
<li>For <strong>OceanBase V4.2.4 and later</strong>, but before <strong>OceanBase V4.3.0</strong>, or for versions after <strong>OceanBase V4.3.3</strong>, you can use the <strong>Execution Profile</strong> to monitor SQL execution in real-time. The Execution Profile helps you quickly view execution details and identify performance bottlenecks.</li>
</ul>
</main>

### Accessing the execution profile

- **Option 1**: While the SQL statement is executing in the SQL window, click **View Execution Profile** in the **Logs** tab.

    <main id="notice" type='notice'>
    <h4>Notice</h4>
    <p>If the SQL statement execution time is less than one second, the option to view the execution profile may not be available in the Logs tab.</p>
    </main>

- **Option 2**: After the SQL statement has executed, click the Execution Profile icon in the results.

   <img src="https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/431/500.sql-development/500.perform-analysis/Execution%20Profile/2EN.png" width="900">

- **Option 3**: After the SQL statement has executed, click the **TRACE ID** in the **Execution Records** tab to access the execution profile.

   <img src="https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/431/500.sql-development/500.perform-analysis/Execution%20Profile/3EN.png" width="900">

### Execution analysis

The **Execution Details**, or Execution Profile, provides a visual representation and data collection for SQL execution plans. It allows real-time monitoring of operator execution status, time details, I/O, and runtime data, while summarizing and ranking the overall execution time.

<img src="https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/431/500.sql-development/500.perform-analysis/Execution%20Profile/4EN.png" width="900">

Using the execution profile, you can:

- View the actual execution plan of OceanBase in a graphical format, making it easier to understand the execution sequence and relationships of operators.

- Quickly identify execution bottlenecks using execution overviews, real-time I/O statistics, and the top 5 time-consuming operations. ODC sorts these based on CPU time.

- Monitor the execution status, timing, and output rows of operators in real-time. By clicking on an operator node, you can access operator attributes, time details, and I/O and other runtime data on the right side of the screen.

   <img src="https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/431/500.sql-development/500.perform-analysis/Execution%20Profile/4.6EN.png" width="900">

- Analyze standalone and distributed execution plans. Parallel operators can be sorted by DB time, I/O memory, and output rows to quickly locate data skew.

#### SQL execution overview

| Type | Description |
| ------ | ------ | 
| **SQL Execution Overview** | <img src="https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/431/500.sql-development/500.perform-analysis/Execution%20Profile/4.9EN.png" width="600"><ul><li>**CPU time**: Total CPU time for all operators.</li><li>**I/O wait time**: Total I/O wait time for all operators.</li><li>**DB time**: Total time taken to execute the plan.</li><li>**Queue time**: Time spent waiting in the queue.</li><li>**Plan type**: Type of execution plan, which could be Local (LOCAL), Remote (REMOTE), or Distributed (DISTRIBUTED).</li><li>**Is hit plan cache**: Indicates whether the plan cache was hit.</li></ul> |
| **Operator Execution Overview** | <img src="https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/431/500.sql-development/500.perform-analysis/Execution%20Profile/5.0EN.png" width="600"><ul><li>**CPU time**: Total CPU time consumed by the current operator. For parallel operators, this is the aggregate time for all threads.</li><li>**I/O wait time**: I/O wait time for the current operator, including disk I/O and network wait time. For parallel operators, this is the aggregate time for all threads.</li><li>**Parallel**: The degree of parallelism, indicating the number of threads running in parallel for the current operator.</li><li>**Skewness**: Skewness indicates the disparity in output time among parallel threads. A higher value suggests that one node or thread may be slowing down the entire operator.</li><li>**Process name**: Thread number, which can be used to locate the corresponding node's IP and port.</li><li>**Change time**: The time taken by the current thread to output rows, calculated as the time difference between the first and last row output.</li></ul> |

#### I/O statistics

| Type | Description |
| ------ | ------ | 
| **Operator I/O Statistics** | <ul><li>**Output rows**: Number of rows output.</li><li>**Start times**: Number of times the operator has been rescanned. For example, the right child node of a Nested Loop Join operator may be scanned multiple times.</li><li>**Max memory**: Maximum workarea memory used by the operator during runtime.</li><li>**Max disk**: Maximum disk space used by the operator during runtime.</li></ul> |

#### Node attributes

Node attributes consist of the output information and runtime data (other statistics) of an operator.

For more details on node output information, refer to the official OceanBase documentation, for example, [Table Scan operator's attributes](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001378888).

Runtime data vary across different operators and represent important monitoring metrics. For more information on these metrics, refer to the V$SQL_MONITOR_STATNAME view.

### Execution plan

Unlike the **Execution Plan** in the SQL window, the **Execution Profile** displays the actual execution plan, including **Actual Rows** and **Actual Costs**. ODC retrieves the current plan using the DBMS_XPLAN package.

<img src="https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/431/500.sql-development/500.perform-analysis/Execution%20Profile/5EN.png" width="900">

You can also click **Text View** <img src="https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/431/500.sql-development/500.perform-analysis/Execution%20Profile/6.png" width="20"> in the top right corner to switch views and access more detailed plan information, facilitating further SQL optimization.

<img src="https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/431/500.sql-development/500.perform-analysis/Execution%20Profile/7EN.png" width="900">

### End-to-end trace diagnostics

For OceanBase versions above 4.2.0 (with OBProxy version 4.2.0 or later if connected via OBProxy), ODC supports viewing the information on end-to-end trace diagnostics for SQL. For more details, refer to [OceanBase End-to-end Tracing Overview](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001375802).

ODC offers both **Trace View** and **Table View** visualizations for OceanBase's end-to-end trace diagnostic data.

The Trace View shows the overall SQL execution timeline, with support for node expansion and collapse, as well as search highlighting. Hovering over the timeline allows you to view the execution node, start and end times, and detailed data.

<img src="https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/431/500.sql-development/500.perform-analysis/Execution%20Profile/8EN.png" width="900">

Clicking **Table View** <img src="https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/431/500.sql-development/500.perform-analysis/Execution%20Profile/9.png" width="20"> allows you to switch views, enabling filtering and sorting of spans across various dimensions.

<img src="https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/431/500.sql-development/500.perform-analysis/Execution%20Profile/10EN.png" width="900">

ODC also supports exporting end-to-end trace diagnostic data in JSON format, compatible with the OpenTracing protocol. You can import this data into Jaeger for further analysis.

## DB time

<img src="https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/odc/431/500.sql-development/500.perform-analysis/Execution%20Profile/11EN.png" width="900">

In the **Execution Records** tab, hover over the tooltip icon next to **DB Time** to view end-to-end timing information for SQL execution. This helps verify if the time spent in each stage matches the actual execution.